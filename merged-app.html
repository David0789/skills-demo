<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skill æ¥å…¥ç®¡ç†ç³»ç»Ÿ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f7f8fa;
    --bg-tertiary: #f0f1f3;
    --bg-elevated: #f5f6f8;
    --bg-hover: #edeef1;
    --border-subtle: rgba(0,0,0,0.06);
    --border-default: rgba(0,0,0,0.12);
    --border-focus: rgba(59,130,246,0.5);
    --text-primary: #1a1a2e;
    --text-secondary: #6b7280;
    --text-tertiary: #9ca3af;
    --accent-blue: #3b82f6;
    --accent-blue-dim: rgba(59,130,246,0.08);
    --accent-blue-glow: rgba(59,130,246,0.2);
    --accent-green: #10b981;
    --accent-green-dim: rgba(16,185,129,0.08);
    --accent-amber: #d97706;
    --accent-amber-dim: rgba(217,119,6,0.08);
    --accent-red: #ef4444;
    --accent-red-dim: rgba(239,68,68,0.06);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
    --font-sans: 'DM Sans', -apple-system, sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    --transition-fast: 120ms ease;
    --transition-default: 200ms ease;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font-sans);
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
  }

  /* ===== Layout Shell ===== */
  .app-shell {
    display: flex;
    min-height: 100vh;
  }

  .sidebar {
    width: 220px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-subtle);
    padding: 20px 0;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
  }

  .sidebar-brand {
    padding: 0 20px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sidebar-brand-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--accent-blue), #8b5cf6);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sidebar-brand-icon svg { width: 16px; height: 16px; stroke: white; stroke-width: 2.5; }

  .sidebar-brand-name {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--text-primary);
  }

  .nav-section { padding: 0 12px; margin-bottom: 24px; }

  .nav-section-label {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 0 8px;
    margin-bottom: 6px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 7px 8px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
  }

  .nav-item:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .nav-item.active {
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
  }

  .nav-item svg { width: 16px; height: 16px; opacity: 0.7; flex-shrink: 0; }
  .nav-item.active svg { opacity: 1; }

  .sidebar-spacer { flex: 1; }

  .main-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
  }

  /* ===== Page Switching ===== */
  .page { display: none; flex-direction: column; height: 100vh; }
  .page.active { display: flex; }

  /* ===== Buttons ===== */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    font-family: var(--font-sans);
    font-size: 13px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
  }

  .btn svg { width: 15px; height: 15px; }

  .btn-primary {
    background: var(--accent-blue);
    color: #fff;
    box-shadow: 0 1px 3px rgba(91,154,255,0.3);
  }

  .btn-primary:hover {
    background: #6da6ff;
    box-shadow: 0 2px 8px rgba(91,154,255,0.4);
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: #fff;
    color: var(--text-secondary);
    border: 1px solid var(--border-default);
  }

  .btn-secondary:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: rgba(0,0,0,0.2);
  }

  .btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    padding: 5px 8px;
    font-size: 12px;
  }

  .btn-ghost:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .btn-link-skill {
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.2);
    padding: 5px 10px;
    font-size: 12px;
  }

  .btn-link-skill:hover {
    background: rgba(59,130,246,0.12);
    border-color: rgba(59,130,246,0.35);
  }

  .btn-link-skill.linked {
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border-color: rgba(16,185,129,0.2);
  }

  .btn-link-skill.linked:hover {
    background: rgba(16,185,129,0.12);
  }

  .btn-danger {
    background: var(--accent-red-dim);
    color: var(--accent-red);
  }

  .btn-danger:hover {
    background: rgba(239,68,68,0.12);
  }

  .btn-sync {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    border: 1px solid rgba(217,119,6,0.2);
  }

  .btn-sync:hover {
    background: rgba(217,119,6,0.12);
  }

  /* ===== Page Header ===== */
  .page-header {
    padding: 24px 32px;
    border-bottom: 1px solid var(--border-subtle);
    flex-shrink: 0;
  }

  .page-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .page-title {
    font-size: 22px;
    font-weight: 600;
    letter-spacing: -0.03em;
    color: var(--text-primary);
  }

  .page-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  /* ===== Filter Bar ===== */
  .filter-bar {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .search-box {
    position: relative;
    width: 280px;
  }

  .search-box svg {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 15px;
    height: 15px;
    color: var(--text-tertiary);
  }

  .search-input {
    width: 100%;
    padding: 8px 12px 8px 34px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-default);
    background: #ffffff;
    color: var(--text-primary);
    font-family: var(--font-sans);
    font-size: 13px;
    outline: none;
    transition: all var(--transition-fast);
  }

  .search-input:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--accent-blue-dim);
  }

  .search-input::placeholder { color: var(--text-tertiary); }

  .filter-select {
    padding: 8px 32px 8px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-default);
    background: #ffffff;
    color: var(--text-secondary);
    font-family: var(--font-sans);
    font-size: 13px;
    outline: none;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
  }

  .filter-select:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--accent-blue-dim);
  }

  /* ===== Table ===== */
  .table-container {
    padding: 0 32px 32px;
    overflow-y: auto;
    flex: 1;
  }

  .table {
    width: 100%;
    border-collapse: collapse;
  }

  .table th {
    text-align: left;
    padding: 12px 16px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 1px solid var(--border-subtle);
    position: sticky;
    top: 0;
    background: var(--bg-primary);
    z-index: 1;
  }

  .table td {
    padding: 14px 16px;
    font-size: 13px;
    border-bottom: 1px solid var(--border-subtle);
    vertical-align: middle;
  }

  .table tbody tr { transition: background var(--transition-fast); }
  .table tbody tr:hover { background: var(--bg-tertiary); }

  .id-text {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text-secondary);
  }

  .category-name {
    font-weight: 500;
    color: var(--text-primary);
  }

  .category-name-cell {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .skill-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border-radius: 100px;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .skill-tag:hover { background: rgba(16,185,129,0.15); }
  .skill-tag svg { width: 11px; height: 11px; }

  .actions-cell {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .time-text { color: var(--text-tertiary); font-size: 13px; }

  /* ===== Form Page Header ===== */
  .form-page-header {
    padding: 16px 32px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    background: var(--bg-secondary);
  }

  .form-page-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .back-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .back-btn svg { width: 18px; height: 18px; }

  .form-page-title {
    font-size: 15px;
    font-weight: 600;
    letter-spacing: -0.02em;
  }

  .form-page-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* ===== Form Layout ===== */
  .form-layout {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 0;
  }

  .form-panel {
    padding: 28px 32px;
    overflow-y: auto;
    border-right: 1px solid var(--border-subtle);
  }

  .form-group { margin-bottom: 24px; }

  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 8px;
    letter-spacing: 0.01em;
  }

  .form-label .required { color: var(--accent-red); margin-left: 2px; }

  .form-input {
    width: 100%;
    padding: 9px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-default);
    background: #ffffff;
    color: var(--text-primary);
    font-family: var(--font-sans);
    font-size: 13px;
    transition: all var(--transition-fast);
    outline: none;
  }

  .form-input::placeholder { color: var(--text-tertiary); }

  .form-input:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--accent-blue-dim);
    background: #ffffff;
  }

  select.form-input {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 36px;
  }

  select.form-input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  }

  .form-input-row { display: flex; gap: 8px; }
  .form-input-row .form-input { flex: 1; }

  .form-textarea {
    min-height: 140px;
    resize: vertical;
    line-height: 1.6;
    font-family: var(--font-mono);
    font-size: 12.5px;
  }

  .form-hint {
    margin-top: 6px;
    font-size: 12px;
    color: var(--text-tertiary);
    line-height: 1.5;
  }

  .form-hint code {
    font-family: var(--font-mono);
    font-size: 11.5px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--accent-blue);
  }

  .form-divider {
    height: 1px;
    background: var(--border-subtle);
    margin: 28px 0;
  }

  .sync-status-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    margin-top: 10px;
  }

  .sync-status-bar.success {
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border: 1px solid rgba(16,185,129,0.15);
  }

  .sync-status-bar.warning {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    border: 1px solid rgba(217,119,6,0.15);
  }

  .sync-status-bar.loading {
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.15);
  }

  .sync-status-bar svg { width: 14px; height: 14px; flex-shrink: 0; }
  .sync-status-bar span { flex: 1; }

  /* ===== Preview Panel ===== */
  .preview-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-secondary);
    overflow: hidden;
  }

  .preview-header {
    padding: 14px 24px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }

  .preview-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .preview-header-left svg { width: 14px; height: 14px; }

  .preview-version {
    font-family: var(--font-mono);
    font-size: 11px;
    padding: 2px 7px;
    border-radius: 100px;
    background: var(--bg-elevated);
    color: var(--text-tertiary);
    border: 1px solid var(--border-subtle);
  }

  .preview-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
  }

  .preview-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    color: var(--text-tertiary);
    font-size: 13px;
    gap: 12px;
  }

  .preview-empty svg { width: 40px; height: 40px; opacity: 0.3; }

  /* ===== Markdown Preview ===== */
  .md-preview {
    font-size: 13.5px;
    line-height: 1.7;
    color: var(--text-secondary);
  }

  .md-preview h1 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    letter-spacing: -0.03em;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-subtle);
  }

  .md-preview h2 {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 24px;
    margin-bottom: 8px;
  }

  .md-preview h3 {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 18px;
    margin-bottom: 6px;
  }

  .md-preview p { margin-bottom: 12px; }

  .md-preview code {
    font-family: var(--font-mono);
    font-size: 12px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--accent-blue);
  }

  .md-preview pre {
    background: var(--bg-primary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 14px 16px;
    margin: 12px 0;
    overflow-x: auto;
  }

  .md-preview pre code {
    background: none;
    border: none;
    padding: 0;
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .md-preview ul, .md-preview ol { margin: 8px 0 12px 20px; }
  .md-preview li { margin-bottom: 4px; }
  .md-preview strong { color: var(--text-primary); font-weight: 600; }
  .md-preview hr { border: none; height: 1px; background: var(--border-subtle); margin: 20px 0; }

  /* ===== Variable Tags ===== */
  .var-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }

  .var-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: var(--radius-sm);
    font-family: var(--font-mono);
    font-size: 11.5px;
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.15);
    cursor: pointer;
    transition: all var(--transition-fast);
    user-select: none;
  }

  .var-tag:hover {
    background: rgba(59,130,246,0.12);
    border-color: rgba(59,130,246,0.3);
  }

  .var-tag svg { width: 12px; height: 12px; }

  /* ===== Skills List Table ===== */
  .skill-name {
    font-weight: 500;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .skill-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .category-tag {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 100px;
    font-size: 12px;
    font-family: var(--font-mono);
    font-weight: 400;
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border-subtle);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 500;
  }

  .status-badge.normal {
    background: var(--accent-green-dim);
    color: var(--accent-green);
  }

  .status-badge.update-available {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    cursor: pointer;
  }

  .status-badge.update-available:hover { background: rgba(217,119,6,0.12); }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    flex-shrink: 0;
  }

  .status-badge.update-available .status-dot {
    animation: pulse-amber 2s ease-in-out infinite;
  }

  @keyframes pulse-amber {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* ===== Empty State ===== */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 32px;
    text-align: center;
  }

  .empty-state-icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-lg);
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
  }

  .empty-state-icon svg { width: 28px; height: 28px; color: var(--text-tertiary); }

  .empty-state-title {
    font-size: 15px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 6px;
  }

  .empty-state-desc {
    font-size: 13px;
    color: var(--text-tertiary);
    margin-bottom: 20px;
    max-width: 340px;
    line-height: 1.5;
  }

  /* ===== Modal ===== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(4px);
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.active { display: flex; }

  .modal {
    background: #ffffff;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-lg);
    max-width: 560px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }

  .modal-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .modal-close {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
  }

  .modal-close:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .modal-close svg { width: 18px; height: 18px; }

  .modal-body { padding: 24px; overflow-y: auto; }

  .modal-footer {
    padding: 16px 24px;
    border-top: 1px solid var(--border-subtle);
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    flex-shrink: 0;
  }

  /* ===== Linked Skill Info ===== */
  .linked-skill-info {
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 16px;
  }

  .linked-skill-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .linked-skill-name {
    font-weight: 500;
    color: var(--text-primary);
    font-size: 14px;
  }

  .linked-skill-name span {
    color: var(--text-tertiary);
    font-weight: 400;
    font-size: 12px;
    margin-left: 8px;
  }

  .linked-skill-detail {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 8px;
  }

  .linked-skill-detail code {
    font-family: var(--font-mono);
    background: #fff;
    border: 1px solid var(--border-subtle);
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 11px;
  }

  .linked-skill-status {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: 100px;
    font-size: 11px;
    background: var(--accent-green-dim);
    color: var(--accent-green);
  }

  .btn-unlink {
    margin-top: 12px;
    width: 100%;
    justify-content: center;
  }

  /* ===== Toast ===== */
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toast {
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: toastIn 300ms ease, toastOut 300ms ease 2.5s forwards;
    box-shadow: var(--shadow-lg);
  }

  .toast.success {
    background: #ecfdf5;
    color: var(--accent-green);
    border: 1px solid rgba(16,185,129,0.2);
  }

  .toast.info {
    background: #eff6ff;
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.2);
  }

  .toast svg { width: 16px; height: 16px; }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(12px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-8px); }
  }

  /* ===== Animations ===== */
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  .page.active { animation: fadeIn 250ms ease; }
  .syncing .sync-spinner { animation: spin 800ms linear infinite; }

  /* ===== Scrollbar ===== */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }
</style>
</head>
<body>

<div class="app-shell">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-brand">
      <div class="sidebar-brand-icon">
        <svg viewBox="0 0 24 24" fill="none"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      </div>
      <span class="sidebar-brand-name">OpsCenter</span>
    </div>

    <div class="nav-section">
      <div class="nav-section-label">ç›‘æ§å‘Šè­¦</div>
      <a class="nav-item active" onclick="showPage('page-categories')" id="nav-categories">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
        é—®é¢˜åˆ†ç±»
      </a>
      <a class="nav-item" onclick="showPage('page-skills-list')" id="nav-skills">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        è‡ªå®šä¹‰ Skills
      </a>
    </div>

    <div class="sidebar-spacer"></div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">

    <!-- ========== PAGE: å‘Šè­¦é¡¹åˆ—è¡¨ ========== -->
    <div class="page" id="page-alerts">
      <div class="page-header">
        <div class="page-title">å‘Šè­¦é¡¹</div>
      </div>

      <!-- ä¸Šè¾¹ï¼šè¡¨å•å±•ç¤ºåŒºåŸŸ -->
      <div style="padding: 0 32px 24px;">
        <div style="display:grid; grid-template-columns: repeat(4, 1fr) 280px; gap:16px; align-items:end;">
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">å‘Šè­¦è§„åˆ™åç§°</label>
            <input type="text" class="form-input" placeholder="æœç´¢å‘Šè­¦è§„åˆ™åç§°...">
          </div>
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">å‘Šè­¦ç±»å‹</label>
            <select class="form-input">
              <option value="">å…¨éƒ¨ç±»å‹</option>
              <option value="system">ç³»ç»Ÿå‘Šè­¦</option>
              <option value="application">åº”ç”¨å‘Šè­¦</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">æœåŠ¡ç»„</label>
            <select class="form-input">
              <option value="">å…¨éƒ¨æœåŠ¡ç»„</option>
              <option value="db">æ•°æ®åº“æœåŠ¡ç»„</option>
              <option value="k8s">å®¹å™¨å¹³å°ç»„</option>
              <option value="network">ç½‘ç»œæœåŠ¡ç»„</option>
              <option value="app">åº”ç”¨æœåŠ¡ç»„</option>
              <option value="storage">å­˜å‚¨æœåŠ¡ç»„</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">çŠ¶æ€</label>
            <select class="form-input">
              <option value="">å…¨éƒ¨çŠ¶æ€</option>
              <option value="enabled">å·²å¯ç”¨</option>
              <option value="disabled">å·²ç¦ç”¨</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0">
            <button class="btn btn-primary" style="width:100%">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              æ–°å»ºå‘Šè­¦è§„åˆ™
            </button>
          </div>
        </div>
      </div>

      <!-- ä¸‹è¾¹ï¼šåˆ—è¡¨åŒºåŸŸ -->
      <div class="table-container" style="padding-top:0;">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>å‘Šè­¦è§„åˆ™åç§°</th>
              <th>ç±»å‹</th>
              <th>æœåŠ¡ç»„</th>
              <th>çŠ¶æ€</th>
              <th>æœ€åæ›´æ–°æ—¶é—´</th>
              <th style="width:160px">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="alerts-tbody">
            <!-- Rendered by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ========== PAGE: é—®é¢˜åˆ†ç±»åˆ—è¡¨ ========== -->
    <div class="page active" id="page-categories">
      <div class="page-header">
        <div class="page-header-row">
          <div class="page-title">é—®é¢˜åˆ†ç±»</div>
          <button class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            åˆ›å»ºåˆ†ç±»
          </button>
        </div>
        <div class="filter-bar">
          <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" class="search-input" placeholder="æœç´¢åˆ†ç±»åç§°ã€ID...">
          </div>
          <select class="filter-select">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="enabled">å·²å¯ç”¨</option>
            <option value="disabled">å·²ç¦ç”¨</option>
          </select>
        </div>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>é—®é¢˜åˆ†ç±»åç§°</th>
              <th>æœåŠ¡ç»„</th>
              <th>å½’å±å›¢é˜Ÿ</th>
              <th>åˆ›å»ºäºº</th>
              <th>æœ€åæ›´æ–°æ—¶é—´</th>
              <th style="width:140px">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="categories-tbody">
            <!-- Rendered by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ========== PAGE: è‡ªå®šä¹‰ Skills åˆ—è¡¨ ========== -->
    <div class="page" id="page-skills-list">
      <div class="page-header">
        <div class="page-header-row">
          <div>
            <div class="page-title">è‡ªå®šä¹‰ Skills</div>
            <div class="page-subtitle">ä» Skills å¸‚åœºæ¥å…¥å¹¶ç®¡ç†å‘Šè­¦å¤„ç†èƒ½åŠ›</div>
          </div>
          <button class="btn btn-primary" onclick="showCreateForm()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            åˆ›å»º Skill
          </button>
        </div>
      </div>

      <div class="table-container" id="skills-table-container">
        <!-- Table will be rendered by JS -->
      </div>
    </div>

    <!-- ========== PAGE: Skill è¡¨å•é¡µ ========== -->
    <div class="page" id="page-skill-form">
      <div class="form-page-header">
        <div class="form-page-header-left">
          <button class="back-btn" onclick="goBackToList()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <span class="form-page-title" id="form-page-title">åˆ›å»º Skill</span>
        </div>
        <div class="form-page-actions">
          <button class="btn btn-secondary" onclick="goBackToList()">å–æ¶ˆ</button>
          <button class="btn btn-primary" id="form-submit-btn" onclick="submitForm()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
            åˆ›å»º
          </button>
        </div>
      </div>

      <div class="form-layout">
        <!-- Left: Form -->
        <div class="form-panel">
          <div class="form-group">
            <label class="form-label">Skills å¸‚åœºé“¾æ¥ <span class="required">*</span></label>
            <div class="form-input-row">
              <input type="url" class="form-input" id="input-url" placeholder="https://skills-market.example.com/skill/xxx" oninput="onUrlInput(this.value)">
              <button class="btn btn-secondary" id="btn-sync-skill" onclick="syncSkill()" disabled>
                <svg class="sync-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                åŒæ­¥
              </button>
            </div>
            <div id="sync-status" style="display:none"></div>
          </div>

          <div id="update-banner" style="display:none">
            <div class="sync-status-bar warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              <span>æ£€æµ‹åˆ° Skills å¸‚åœºæœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼ˆè¿œç¨‹ v2.1.0 â†’ æœ¬åœ° v2.0.0ï¼‰</span>
              <button class="btn btn-sync" onclick="syncLatest()" style="flex-shrink:0">
                <svg class="sync-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                åŒæ­¥æœ€æ–°ç‰ˆæœ¬
              </button>
            </div>
          </div>

          <div class="form-divider"></div>

          <!-- Skill Name Selector (shown after sync) -->
          <div class="form-group" id="skill-name-group" style="display:none">
            <label class="form-label">é€‰æ‹© Skill <span class="required">*</span></label>
            <select class="form-input" id="select-skill-name" onchange="onSkillNameChange(this.value)">
              <option value="">è¯·é€‰æ‹© Skill</option>
            </select>
            <div class="form-hint" id="skill-name-hint">ä»ä»“åº“ä¸­è¯†åˆ«åˆ°çš„ Skillï¼Œè¯·é€‰æ‹©éœ€è¦æ¥å…¥çš„ Skill</div>
          </div>

          <div class="form-group">
            <label class="form-label">ç»‘å®šå‘Šè­¦é¡¹ <span class="required">*</span></label>
            <select class="form-input" id="select-binding-type" onchange="onBindingTypeChange(this.value)" style="margin-bottom: 8px;">
              <option value="">è¯·é€‰æ‹©ç»‘å®šç±»å‹</option>
              <option value="category">é—®é¢˜åˆ†ç±»ID</option>
              <option value="rule">å‘Šè­¦è§„åˆ™ID</option>
            </select>
            <input type="text" class="form-input" id="input-binding-value" placeholder="è¯·å…ˆé€‰æ‹©ç»‘å®šç±»å‹" disabled oninput="onBindingValueInput(this.value)">
            <div class="form-hint" id="binding-hint">é€‰æ‹©ç»‘å®šç±»å‹åï¼Œè¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„è·¯ç”±è§„åˆ™</div>
          </div>

          <div class="form-group">
            <label class="form-label">MCP Server <span class="required">*</span></label>
            <div class="form-input-row">
              <input type="text" class="form-input" id="input-mcp" placeholder="https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp" oninput="onMcpInput(this.value)">
              <button class="btn btn-secondary" id="btn-test-mcp" onclick="testMcpServer()" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:15px;height:15px"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                æµ‹è¯•æƒé™
              </button>
            </div>
            <div class="form-hint">å¦‚éœ€é…ç½®å¤šä¸ª MCP Serverï¼Œè¯·ä»¥è‹±æ–‡é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š<code>https://host1/mcp,https://host2/mcp</code></div>
            <div id="mcp-test-status" style="display:none"></div>
          </div>

          <div class="form-group">
            <label class="form-label">è°ƒç”¨ Prompt</label>
            <textarea class="form-input form-textarea" id="input-prompt" placeholder="è¯·ä½¿ç”¨#{skillName}è¿›è¡Œå‘Šè­¦è¯Šæ–­ï¼š#{ticketString}"></textarea>
            <div class="form-hint">å¯é€‰å¡«ã€‚ä¸å¡«æ—¶ä½¿ç”¨é»˜è®¤æ¨¡æ¿ã€‚å˜é‡å ä½ç¬¦ä¼šåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨æ›¿æ¢ä¸ºå®é™…å€¼ã€‚</div>
            <div class="var-tags">
              <span class="var-tag" onclick="insertVar('#{skillName}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{skillName}
              </span>
              <span class="var-tag" onclick="insertVar('#{ticketString}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{ticketString}
              </span>
              <span class="var-tag" onclick="insertVar('#{alertLevel}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{alertLevel}
              </span>
              <span class="var-tag" onclick="insertVar('#{serviceName}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{serviceName}
              </span>
            </div>
          </div>
        </div>

        <!-- Right: Preview -->
        <div class="preview-panel">
          <div class="preview-header">
            <div class="preview-header-left">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              Skill é¢„è§ˆ
            </div>
            <span class="preview-version" id="preview-version" style="display:none">v2.0.0</span>
          </div>
          <div class="preview-body" id="preview-body">
            <div class="preview-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <span>è¾“å…¥ Skills å¸‚åœºé“¾æ¥å¹¶åŒæ­¥å<br>æ­¤å¤„å°†é¢„è§ˆ skill.md å†…å®¹</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ========== Modals ========== -->

<!-- Link Skill Modal (for Categories) -->
<div class="modal-overlay" id="link-skill-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">å…³è”è¯Šæ–­ Skill</div>
      <button class="modal-close" onclick="closeLinkSkillModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Skills å¸‚åœºé“¾æ¥ <span class="required">*</span></label>
        <div class="form-input-row">
          <input type="url" class="form-input" id="link-input-url" placeholder="https://skills-market.example.com/skill/xxx" oninput="onLinkUrlInput(this.value)">
          <button class="btn btn-secondary" id="link-btn-sync" onclick="linkSyncSkill()" disabled>
            <svg class="sync-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            åŒæ­¥
          </button>
        </div>
        <div id="link-sync-status" style="display:none"></div>
      </div>

      <div class="form-group" id="link-skill-name-group" style="display:none">
        <label class="form-label">é€‰æ‹© Skill <span class="required">*</span></label>
        <select class="form-input" id="link-select-skill-name" onchange="onLinkSkillNameChange(this.value)">
          <option value="">è¯·é€‰æ‹© Skill</option>
        </select>
        <div class="form-hint">ä»ä»“åº“ä¸­è¯†åˆ«åˆ°çš„ Skillï¼Œè¯·é€‰æ‹©éœ€è¦å…³è”çš„ Skill</div>
      </div>

      <div class="form-group">
        <label class="form-label">MCP Server <span class="required">*</span></label>
        <div class="form-input-row">
          <input type="text" class="form-input" id="link-input-mcp" placeholder="https://pre-mcp.alibaba-inc.com/xxx/mcp" oninput="onLinkMcpInput(this.value)">
          <button class="btn btn-secondary" id="link-btn-test-mcp" onclick="linkTestMcp()" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            æµ‹è¯•
          </button>
        </div>
        <div class="form-hint">å¦‚éœ€é…ç½®å¤šä¸ª MCP Serverï¼Œè¯·ä»¥è‹±æ–‡é€—å·åˆ†éš”</div>
        <div id="link-mcp-test-status" style="display:none"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeLinkSkillModal()">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="submitLinkSkill()">ç¡®è®¤å…³è”</button>
    </div>
  </div>
</div>

<!-- View Skill Modal (for Categories & Alerts) -->
<div class="modal-overlay" id="view-skill-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">å·²å…³è”çš„è¯Šæ–­ Skill</div>
      <button class="modal-close" onclick="closeViewSkillModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body" id="view-skill-content">
      <!-- Rendered by JS -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-unlink" onclick="handleUnlinkSkill()">å–æ¶ˆå…³è”</button>
      <button class="btn btn-secondary" onclick="closeViewSkillModal()">å…³é—­</button>
    </div>
  </div>
</div>

<!-- Delete Skill Modal -->
<div class="modal-overlay" id="delete-modal">
  <div class="modal">
    <div class="modal-body" style="padding: 24px;">
      <div class="modal-title" style="font-size: 15px; margin-bottom: 8px;">ç¡®è®¤åˆ é™¤</div>
      <div class="form-hint" style="color:var(--text-secondary);line-height:1.5;">åˆ é™¤åè¯¥ Skill å°†ä¸å†å‚ä¸å‘Šè­¦å¤„ç†æµç¨‹ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:20px;">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">å–æ¶ˆ</button>
        <button class="btn btn-danger" onclick="confirmDelete()">åˆ é™¤</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ===== Mock Data =====
const MOCK_SKILL_MD = `# æ•°æ®åº“å‘Šè­¦è¯Šæ–­ Skill

æ™ºèƒ½åˆ†ææ•°æ®åº“ç›¸å…³å‘Šè­¦ï¼Œæä¾›æ ¹å› åˆ†æå’Œå¤„ç½®å»ºè®®ã€‚

## æ¦‚è¿°

æœ¬ Skill ä¸“æ³¨äºæ•°æ®åº“ï¼ˆMySQLã€PostgreSQLã€MongoDBï¼‰ç›¸å…³å‘Šè­¦çš„è‡ªåŠ¨åŒ–è¯Šæ–­ï¼Œè¦†ç›–è¿æ¥æ± è€—å°½ã€æ…¢æŸ¥è¯¢å †ç§¯ã€ä¸»ä»å»¶è¿Ÿã€ç£ç›˜ç©ºé—´ä¸è¶³ç­‰å¸¸è§åœºæ™¯ã€‚

## èƒ½åŠ›èŒƒå›´

- **è¿æ¥æ± åˆ†æ**ï¼šæ£€æµ‹è¿æ¥æ³„æ¼ã€å¹¶å‘å³°å€¼ã€é…ç½®ä¸å½“
- **æ…¢æŸ¥è¯¢è¯Šæ–­**ï¼šè¯†åˆ«å…¨è¡¨æ‰«æã€ç´¢å¼•ç¼ºå¤±ã€é”ç­‰å¾…
- **ä¸»ä»åŒæ­¥**ï¼šå»¶è¿Ÿè¶‹åŠ¿åˆ†æã€æ–­å¼€åŸå› å®šä½
- **èµ„æºé¢„è­¦**ï¼šç£ç›˜ / å†…å­˜ / CPU è¶‹åŠ¿é¢„æµ‹

## è¾“å…¥æ ¼å¼

\`\`\`json
{
  "alert_type": "db_connection_pool_exhausted",
  "service": "order-service",
  "metrics": { ... },
  "timestamp": "2026-02-27T10:30:00Z"
}
\`\`\`

## è¾“å‡ºæ ¼å¼

### æ ¹å› åˆ†æ
ç»™å‡ºæœ€å¯èƒ½çš„ 1-3 ä¸ªåŸå› åŠç½®ä¿¡åº¦è¯„ä¼°ã€‚

### å¤„ç½®å»ºè®®
æŒ‰ä¼˜å…ˆçº§æ’åºçš„å¤„ç½®æ­¥éª¤ï¼ŒåŒ…å«å…·ä½“å‘½ä»¤æˆ–æ“ä½œæŒ‡å¼•ã€‚

### å†å²å…³è”
è‡ªåŠ¨åŒ¹é…æœ€è¿‘ 30 å¤©å†…çš„ç›¸ä¼¼å‘Šè­¦åŠå…¶è§£å†³æ–¹æ¡ˆã€‚

---

**ç‰ˆæœ¬**: v2.0.0 | **ä½œè€…**: OpsTeam | **æ›´æ–°æ—¥æœŸ**: 2026-02-20`;

// Alerts Data
let alertRules = [
  {
    id: 'alert_db_cpu_001',
    name: 'æ•°æ®åº“CPUä½¿ç”¨ç‡å‘Šè­¦',
    type: 'system',
    serviceGroup: 'æ•°æ®åº“æœåŠ¡ç»„',
    status: 'enabled',
    updatedAt: '2026-02-20 14:30',
    linkedSkill: null
  },
  {
    id: 'alert_db_mem_002',
    name: 'æ•°æ®åº“å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦',
    type: 'system',
    serviceGroup: 'æ•°æ®åº“æœåŠ¡ç»„',
    status: 'enabled',
    updatedAt: '2026-02-21 09:15',
    linkedSkill: {
      skillName: 'db-diagnosis',
      marketUrl: 'https://skills-market.example.com/skill/db-diagnosis',
      mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp',
      version: 'v2.0.0'
    }
  },
  {
    id: 'alert_k8s_pod_003',
    name: 'K8s Podå¼‚å¸¸é‡å¯',
    type: 'application',
    serviceGroup: 'å®¹å™¨å¹³å°ç»„',
    status: 'enabled',
    updatedAt: '2026-02-22 16:45',
    linkedSkill: null
  },
  {
    id: 'alert_app_response_004',
    name: 'åº”ç”¨å“åº”æ—¶é—´è¶…æ—¶',
    type: 'application',
    serviceGroup: 'åº”ç”¨æœåŠ¡ç»„',
    status: 'disabled',
    updatedAt: '2026-02-18 11:20',
    linkedSkill: null
  },
  {
    id: 'alert_net_timeout_005',
    name: 'ç½‘ç»œè¿æ¥è¶…æ—¶å‘Šè­¦',
    type: 'system',
    serviceGroup: 'ç½‘ç»œæœåŠ¡ç»„',
    status: 'enabled',
    updatedAt: '2026-02-23 10:00',
    linkedSkill: {
      skillName: 'network-diagnosis',
      marketUrl: 'https://skills-market.example.com/skill/network-diagnosis',
      mcpServers: 'https://pre-mcp.alibaba-inc.com/network-diag-server/mcp',
      version: 'v1.0.0'
    }
  },
  {
    id: 'alert_storage_disk_006',
    name: 'å­˜å‚¨ç£ç›˜ç©ºé—´ä¸è¶³',
    type: 'system',
    serviceGroup: 'å­˜å‚¨æœåŠ¡ç»„',
    status: 'enabled',
    updatedAt: '2026-02-24 08:30',
    linkedSkill: null
  }
];

// Categories Data
let categories = [
  {
    id: 'incident_db_001',
    name: 'æ•°æ®åº“å‘Šè­¦',
    serviceGroup: 'æ•°æ®åº“æœåŠ¡ç»„',
    team: 'åŸºç¡€æ¶æ„å›¢é˜Ÿ',
    createdBy: 'å¼ æ˜',
    updatedAt: '2026-02-20 14:30',
    linkedSkill: null
  },
  {
    id: 'incident_k8s_002',
    name: 'K8s å®¹å™¨å¼‚å¸¸',
    serviceGroup: 'å®¹å™¨å¹³å°ç»„',
    team: 'å¹³å°ç ”å‘å›¢é˜Ÿ',
    createdBy: 'æä¼Ÿ',
    updatedAt: '2026-02-21 09:15',
    linkedSkill: null
  },
  {
    id: 'incident_net_003',
    name: 'ç½‘ç»œè¿é€šæ€§',
    serviceGroup: 'ç½‘ç»œæœåŠ¡ç»„',
    team: 'åŸºç¡€æ¶æ„å›¢é˜Ÿ',
    createdBy: 'ç‹èŠ³',
    updatedAt: '2026-02-22 16:45',
    linkedSkill: {
      skillName: 'network-diagnosis',
      marketUrl: 'https://skills-market.example.com/skill/network-diagnosis',
      mcpServers: 'https://pre-mcp.alibaba-inc.com/network-diag-server/mcp',
      version: 'v1.0.0'
    }
  },
  {
    id: 'incident_app_004',
    name: 'åº”ç”¨æœåŠ¡å¼‚å¸¸',
    serviceGroup: 'åº”ç”¨æœåŠ¡ç»„',
    team: 'ä¸šåŠ¡ç ”å‘å›¢é˜Ÿ',
    createdBy: 'å¼ æ˜',
    updatedAt: '2026-02-18 11:20',
    linkedSkill: null
  },
  {
    id: 'incident_storage_005',
    name: 'å­˜å‚¨å‘Šè­¦',
    serviceGroup: 'å­˜å‚¨æœåŠ¡ç»„',
    team: 'åŸºç¡€æ¶æ„å›¢é˜Ÿ',
    createdBy: 'æä¼Ÿ',
    updatedAt: '2026-02-23 10:00',
    linkedSkill: {
      skillName: 'db-diagnosis',
      marketUrl: 'https://skills-market.example.com/skill/db-diagnosis',
      mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp',
      version: 'v2.0.0'
    }
  }
];

// Skills Data
let skills = [
  {
    id: 1,
    name: 'æ•°æ®åº“å‘Šè­¦è¯Šæ–­',
    icon: 'ğŸ—„ï¸',
    bindingType: 'category',
    bindingValue: 'incident_db_001',
    skillName: 'db-diagnosis',
    createdAt: '2026-02-15',
    createdBy: 'å¼ æ˜',
    status: 'normal',
    url: 'https://skills-market.example.com/skill/db-diagnosis',
    version: 'v2.0.0',
    prompt: 'è¯·æ ¹æ®ä»¥ä¸‹å‘Šè­¦ä¿¡æ¯è¿›è¡Œæ•°æ®åº“å‘Šè­¦è¯Šæ–­ï¼š\n\n#{ticketString}\n\nè¯·è¾“å‡ºæ ¹å› åˆ†æå’Œå¤„ç½®å»ºè®®ã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp',
    skillMd: MOCK_SKILL_MD
  },
  {
    id: 2,
    name: 'K8s å®¹å™¨å¼‚å¸¸åˆ†æ',
    icon: 'âˆ',
    bindingType: 'rule',
    bindingValue: 'alert_rule_k8s_002',
    skillName: 'k8s-analysis',
    createdAt: '2026-02-18',
    createdBy: 'æä¼Ÿ',
    status: 'update-available',
    url: 'https://skills-market.example.com/skill/k8s-analysis',
    version: 'v1.3.0',
    prompt: 'ä»¥ä¸‹æ˜¯ K8s å®¹å™¨å‘Šè­¦ä¿¡æ¯ï¼š\n\n#{ticketString}\n\nè¯·åˆ†æ Pod å¼‚å¸¸åŸå› å¹¶ç»™å‡ºæ¢å¤æ–¹æ¡ˆã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp,https://pre-mcp.alibaba-inc.com/k8s-diag-server/mcp',
    skillMd: '# K8s å®¹å™¨å¼‚å¸¸åˆ†æ Skill\n\nè‡ªåŠ¨åˆ†æ Kubernetes ç¯å¢ƒä¸‹çš„å®¹å™¨å¼‚å¸¸...'
  },
  {
    id: 3,
    name: 'ç½‘ç»œè¿é€šæ€§è¯Šæ–­',
    icon: 'ğŸŒ',
    bindingType: 'category',
    bindingValue: 'incident_net_003',
    skillName: 'network-diagnosis',
    createdAt: '2026-02-22',
    createdBy: 'ç‹èŠ³',
    status: 'normal',
    url: 'https://skills-market.example.com/skill/network-diagnosis',
    version: 'v1.0.0',
    prompt: 'è¯·å¯¹ä»¥ä¸‹ç½‘ç»œå‘Šè­¦è¿›è¡Œåˆ†æï¼š\n\n#{ticketString}\n\nç¡®è®¤æ˜¯å¦ä¸ºç½‘ç»œæŠ–åŠ¨ã€ä¸¢åŒ…æˆ– DNS å¼‚å¸¸ã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/network-diag-server/mcp',
    skillMd: '# ç½‘ç»œè¿é€šæ€§è¯Šæ–­ Skill\n\nç½‘ç»œå±‚å‘Šè­¦çš„è‡ªåŠ¨è¯Šæ–­ä¸æ’æŸ¥å»ºè®®...'
  }
];

// Global State
let editingId = null;
let deleteTargetId = null;
let nextId = 4;
let detectedSkillNames = [];
let selectedSkillName = '';
let currentCategoryId = null;
let currentAlertId = null;
let detectedLinkSkillNames = [];
let selectedLinkSkillName = '';

// ===== Render Alerts Table =====
function renderAlertsTable() {
  const tbody = document.getElementById('alerts-tbody');
  tbody.innerHTML = alertRules.map(rule => `
    <tr>
      <td><span class="id-text">${rule.id}</span></td>
      <td>
        <div class="category-name-cell">
          <span class="category-name">${rule.name}</span>
          ${rule.linkedSkill ? `
            <span class="skill-tag" onclick="viewAlertSkill('${rule.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              ${rule.linkedSkill.skillName}
            </span>
          ` : ''}
        </div>
      </td>
      <td>
        <span class="category-tag" style="background:${rule.type === 'system' ? 'rgba(59,130,246,0.08)' : 'rgba(168,85,247,0.08)'};color:${rule.type === 'system' ? 'var(--accent-blue)' : '#a855f7'}">
          ${rule.type === 'system' ? 'ç³»ç»Ÿå‘Šè­¦' : 'åº”ç”¨å‘Šè­¦'}
        </span>
      </td>
      <td>${rule.serviceGroup}</td>
      <td>
        <span class="status-badge ${rule.status === 'enabled' ? 'normal' : ''}" style="${rule.status === 'disabled' ? 'background:var(--accent-red-dim);color:var(--accent-red)' : ''}">
          <span class="status-dot"></span>${rule.status === 'enabled' ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}
        </span>
      </td>
      <td><span class="time-text">${rule.updatedAt}</span></td>
      <td>
        <div class="actions-cell">
          ${rule.linkedSkill ? `
            <button class="btn btn-link-skill linked" onclick="viewAlertSkill('${rule.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:12px;height:12px"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              æŸ¥çœ‹
            </button>
          ` : `
            <button class="btn btn-link-skill" onclick="openAlertLinkModal('${rule.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:12px;height:12px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              å…³è”
            </button>
          `}
          <button class="btn btn-ghost" title="ç¼–è¾‘">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
          <button class="btn btn-ghost" title="åˆ é™¤" style="color:var(--text-tertiary)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

// ===== Page Navigation =====
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');

  // Update nav active state
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (pageId === 'page-alerts') {
    document.getElementById('nav-alerts')?.classList.add('active');
  } else if (pageId === 'page-categories' || pageId === 'page-category-form') {
    document.getElementById('nav-categories')?.classList.add('active');
  } else {
    document.getElementById('nav-skills')?.classList.add('active');
  }
}

// ===== Render Categories Table =====
function renderCategoriesTable() {
  const tbody = document.getElementById('categories-tbody');
  tbody.innerHTML = categories.map(cat => `
    <tr>
      <td><span class="id-text">${cat.id}</span></td>
      <td>
        <div class="category-name-cell">
          <span class="category-name">${cat.name}</span>
          ${cat.linkedSkill ? `
            <span class="skill-tag" onclick="viewSkill('${cat.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              ${cat.linkedSkill.skillName}
            </span>
          ` : ''}
        </div>
      </td>
      <td>${cat.serviceGroup}</td>
      <td>${cat.team}</td>
      <td>${cat.createdBy}</td>
      <td><span class="time-text">${cat.updatedAt}</span></td>
      <td>
        <div class="actions-cell">
          ${cat.linkedSkill ? `
            <button class="btn btn-link-skill linked" onclick="viewSkill('${cat.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:12px;height:12px"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              æŸ¥çœ‹
            </button>
          ` : `
            <button class="btn btn-link-skill" onclick="openLinkSkillModal('${cat.id}')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:12px;height:12px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              å…³è”
            </button>
          `}
          <button class="btn btn-ghost" title="ç¼–è¾‘">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
          <button class="btn btn-ghost" title="åˆ é™¤" style="color:var(--text-tertiary)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

// ===== Render Skills Table =====
function renderSkillsTable() {
  const container = document.getElementById('skills-table-container');
  if (skills.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        </div>
        <div class="empty-state-title">è¿˜æ²¡æœ‰è‡ªå®šä¹‰ Skill</div>
        <div class="empty-state-desc">ä» Skills å¸‚åœºæ¥å…¥ Skill æ¥å¢å¼ºå‘Šè­¦å¤„ç†èƒ½åŠ›ï¼Œæ”¯æŒè‡ªå®šä¹‰è°ƒç”¨ Prompt å’Œé—®é¢˜åˆ†ç±»è·¯ç”±ã€‚</div>
        <button class="btn btn-primary" onclick="showCreateForm()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          åˆ›å»ºç¬¬ä¸€ä¸ª Skill
        </button>
      </div>`;
    return;
  }

  container.innerHTML = `
    <table class="table">
      <thead>
        <tr>
          <th>Skill åç§°</th>
          <th>ç»‘å®šå‘Šè­¦é¡¹</th>
          <th>åˆ›å»ºäºº</th>
          <th>åˆ›å»ºæ—¶é—´</th>
          <th>çŠ¶æ€</th>
          <th style="width:120px">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        ${skills.map(s => `
          <tr>
            <td>
              <div class="skill-name">
                <div class="skill-icon">${s.icon}</div>
                <div>
                  <div>${s.name}</div>
                  ${s.skillName ? `<div style="font-size:11px;color:var(--text-tertiary);margin-top:2px;font-family:var(--font-mono)">${s.skillName}</div>` : ''}
                </div>
              </div>
            </td>
            <td>
              <span class="category-tag" style="margin-right:4px">${s.bindingType === 'category' ? 'é—®é¢˜åˆ†ç±»' : 'å‘Šè­¦è§„åˆ™'}</span>
              <span class="category-tag">${s.bindingValue}</span>
            </td>
            <td><span style="font-size:13px;color:var(--text-secondary)">${s.createdBy || '-'}</span></td>
            <td><span class="time-text">${s.createdAt}</span></td>
            <td>
              ${s.status === 'normal'
                ? '<span class="status-badge normal"><span class="status-dot"></span>å·²åŒæ­¥</span>'
                : `<span class="status-badge update-available" onclick="editSkill(${s.id})"><span class="status-dot"></span>æœ‰æ›´æ–°</span>`
              }
            </td>
            <td>
              <div class="actions-cell">
                <button class="btn btn-ghost" onclick="editSkill(${s.id})" title="ç¼–è¾‘">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:15px;height:15px"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                  ç¼–è¾‘
                </button>
                <button class="btn btn-ghost" onclick="showDeleteModal(${s.id})" title="åˆ é™¤" style="color:var(--text-tertiary)">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:15px;height:15px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>`;
}

// ===== Link Skill Modal (Categories) =====
function openLinkSkillModal(catId) {
  currentCategoryId = catId;
  detectedLinkSkillNames = [];
  selectedLinkSkillName = '';
  document.getElementById('link-input-url').value = '';
  document.getElementById('link-input-mcp').value = '';
  document.getElementById('link-select-skill-name').innerHTML = '<option value="">è¯·é€‰æ‹© Skill</option>';
  document.getElementById('link-skill-name-group').style.display = 'none';
  document.getElementById('link-sync-status').style.display = 'none';
  document.getElementById('link-mcp-test-status').style.display = 'none';
  document.getElementById('link-btn-sync').disabled = true;
  document.getElementById('link-btn-test-mcp').disabled = true;
  document.getElementById('link-skill-modal').classList.add('active');
}

function closeLinkSkillModal() {
  document.getElementById('link-skill-modal').classList.remove('active');
  currentCategoryId = null;
}

function onLinkUrlInput(value) {
  document.getElementById('link-btn-sync').disabled = !value.startsWith('https://') || value.length < 20;
}

function onLinkMcpInput(value) {
  document.getElementById('link-btn-test-mcp').disabled = !value.startsWith('https://') || value.length < 10;
  document.getElementById('link-mcp-test-status').style.display = 'none';
}

function onLinkSkillNameChange(value) {
  selectedLinkSkillName = value;
}

function linkSyncSkill() {
  const btn = document.getElementById('link-btn-sync');
  const status = document.getElementById('link-sync-status');
  btn.disabled = true;
  btn.querySelector('svg').classList.add('syncing', 'spin');
  status.style.display = 'block';
  status.innerHTML = `<div class="sync-status-bar loading"><svg class="sync-spinner spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg><span>æ­£åœ¨åŒæ­¥...</span></div>`;

  setTimeout(() => {
    btn.disabled = false;
    btn.querySelector('svg').classList.remove('spin');
    detectedLinkSkillNames = ['db-diagnosis', 'db-slow-query', 'db-connection-pool'];
    const select = document.getElementById('link-select-skill-name');
    select.innerHTML = '<option value="">è¯·é€‰æ‹© Skill</option>';
    detectedLinkSkillNames.forEach(s => { select.innerHTML += `<option value="${s}">${s}</option>`; });
    document.getElementById('link-skill-name-group').style.display = 'block';
    status.innerHTML = `<div class="sync-status-bar success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>åŒæ­¥æˆåŠŸ Â· æ£€æµ‹åˆ° ${detectedLinkSkillNames.length} ä¸ª Skill</span></div>`;
  }, 1500);
}

function linkTestMcp() {
  const btn = document.getElementById('link-btn-test-mcp');
  const status = document.getElementById('link-mcp-test-status');
  btn.disabled = true;
  status.style.display = 'block';
  status.innerHTML = `<div class="sync-status-bar loading"><svg class="sync-spinner spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg><span>æµ‹è¯•ä¸­...</span></div>`;

  setTimeout(() => {
    btn.disabled = false;
    status.innerHTML = `<div class="sync-status-bar success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>æƒé™éªŒè¯é€šè¿‡</span></div>`;
  }, 1200);
}

function submitLinkSkill() {
  const url = document.getElementById('link-input-url').value;
  const mcp = document.getElementById('link-input-mcp').value;
  if (!url || !mcp) { showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'info'); return; }
  if (detectedLinkSkillNames.length === 0 || !selectedLinkSkillName) { showToast('è¯·å…ˆåŒæ­¥å¹¶é€‰æ‹© Skill', 'info'); return; }

  // Support both category and alert linking
  if (currentCategoryId) {
    const cat = categories.find(c => c.id === currentCategoryId);
    if (cat) {
      cat.linkedSkill = { skillName: selectedLinkSkillName, marketUrl: url, mcpServers: mcp, version: 'v2.0.0' };
    }
    closeLinkSkillModal();
    renderCategoriesTable();
    showToast('Skill å…³è”æˆåŠŸ', 'success');
  } else if (currentAlertId) {
    const rule = alertRules.find(r => r.id === currentAlertId);
    if (rule) {
      rule.linkedSkill = { skillName: selectedLinkSkillName, marketUrl: url, mcpServers: mcp, version: 'v2.0.0' };
    }
    closeLinkSkillModal();
    renderAlertsTable();
    showToast('Skill å…³è”æˆåŠŸ', 'success');
  }
}

// ===== Unlink Handler (supports both categories and alerts) =====
function handleUnlinkSkill() {
  if (!confirm('ç¡®å®šè¦å–æ¶ˆå…³è”è¯¥ Skill å—ï¼Ÿ')) return;

  if (currentCategoryId) {
    const cat = categories.find(c => c.id === currentCategoryId);
    if (cat) cat.linkedSkill = null;
    closeViewSkillModal();
    renderCategoriesTable();
    showToast('å·²å–æ¶ˆå…³è”', 'info');
  } else if (currentAlertId) {
    const rule = alertRules.find(r => r.id === currentAlertId);
    if (rule) rule.linkedSkill = null;
    closeViewSkillModal();
    renderAlertsTable();
    showToast('å·²å–æ¶ˆå…³è”', 'info');
  }
}

// ===== View Skill Modal (Categories) =====
function viewSkill(catId) {
  currentCategoryId = catId;
  const cat = categories.find(c => c.id === catId);
  if (!cat?.linkedSkill) return;

  const skill = cat.linkedSkill;
  document.getElementById('view-skill-content').innerHTML = `
    <div class="linked-skill-info">
      <div class="linked-skill-header">
        <div class="linked-skill-name">${skill.skillName}<span>v${skill.version}</span></div>
        <div class="linked-skill-status"><span class="status-dot"></span>å·²å…³è”</div>
      </div>
      <div class="linked-skill-detail">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/></svg>
        <span>æ¥æº:</span><code>${skill.marketUrl}</code>
      </div>
      <div class="linked-skill-detail">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/></svg>
        <span>MCP Server:</span><code>${skill.mcpServers}</code>
      </div>
    </div>`;
  document.getElementById('view-skill-modal').classList.add('active');
}

function closeViewSkillModal() {
  document.getElementById('view-skill-modal').classList.remove('active');
  currentCategoryId = null;
  currentAlertId = null;
}

// ===== Alert Skill Modal Functions =====
function openAlertLinkModal(ruleId) {
  currentAlertId = ruleId;
  detectedLinkSkillNames = [];
  selectedLinkSkillName = '';
  document.getElementById('link-input-url').value = '';
  document.getElementById('link-input-mcp').value = '';
  document.getElementById('link-select-skill-name').innerHTML = '<option value="">è¯·é€‰æ‹© Skill</option>';
  document.getElementById('link-skill-name-group').style.display = 'none';
  document.getElementById('link-sync-status').style.display = 'none';
  document.getElementById('link-mcp-test-status').style.display = 'none';
  document.getElementById('link-btn-sync').disabled = true;
  document.getElementById('link-btn-test-mcp').disabled = true;
  document.getElementById('link-skill-modal').classList.add('active');
}

function viewAlertSkill(ruleId) {
  currentAlertId = ruleId;
  const rule = alertRules.find(r => r.id === ruleId);
  if (!rule?.linkedSkill) return;

  const skill = rule.linkedSkill;
  document.getElementById('view-skill-content').innerHTML = `
    <div class="linked-skill-info">
      <div class="linked-skill-header">
        <div class="linked-skill-name">${skill.skillName}<span>v${skill.version}</span></div>
        <div class="linked-skill-status"><span class="status-dot"></span>å·²å…³è”</div>
      </div>
      <div class="linked-skill-detail">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/></svg>
        <span>æ¥æº:</span><code>${skill.marketUrl}</code>
      </div>
      <div class="linked-skill-detail">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/></svg>
        <span>MCP Server:</span><code>${skill.mcpServers}</code>
      </div>
    </div>`;
  document.getElementById('view-skill-modal').classList.add('active');
}

// ===== Skills Form Page =====
function showCreateForm() {
  editingId = null;
  document.getElementById('form-page-title').textContent = 'åˆ›å»º Skill';
  document.getElementById('form-submit-btn').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>åˆ›å»º`;
  document.getElementById('input-url').value = '';
  document.getElementById('select-binding-type').value = '';
  document.getElementById('input-binding-value').value = '';
  document.getElementById('input-binding-value').disabled = true;
  document.getElementById('input-binding-value').placeholder = 'è¯·å…ˆé€‰æ‹©ç»‘å®šç±»å‹';
  document.getElementById('binding-hint').textContent = 'é€‰æ‹©ç»‘å®šç±»å‹åï¼Œè¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„è·¯ç”±è§„åˆ™';
  document.getElementById('input-mcp').value = '';
  document.getElementById('input-prompt').value = '';
  document.getElementById('sync-status').style.display = 'none';
  document.getElementById('update-banner').style.display = 'none';
  document.getElementById('preview-version').style.display = 'none';
  document.getElementById('skill-name-group').style.display = 'none';
  document.getElementById('select-skill-name').disabled = false;
  document.getElementById('skill-name-hint').textContent = 'ä»ä»“åº“ä¸­è¯†åˆ«åˆ°çš„ Skillï¼Œè¯·é€‰æ‹©éœ€è¦æ¥å…¥çš„ Skill';
  document.getElementById('mcp-test-status').style.display = 'none';
  document.getElementById('btn-test-mcp').disabled = true;
  document.getElementById('preview-body').innerHTML = `
    <div class="preview-empty">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span>è¾“å…¥ Skills å¸‚åœºé“¾æ¥å¹¶åŒæ­¥å<br>æ­¤å¤„å°†é¢„è§ˆ skill.md å†…å®¹</span>
    </div>`;
  document.getElementById('btn-sync-skill').disabled = true;
  showPage('page-skill-form');
}

function editSkill(id) {
  const skill = skills.find(s => s.id === id);
  if (!skill) return;

  editingId = id;
  document.getElementById('form-page-title').textContent = 'ç¼–è¾‘ Skill';
  document.getElementById('form-submit-btn').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>ä¿å­˜`;
  document.getElementById('input-url').value = skill.url;
  document.getElementById('select-binding-type').value = skill.bindingType || '';
  document.getElementById('input-binding-value').value = skill.bindingValue || '';
  document.getElementById('input-binding-value').disabled = !skill.bindingType;
  document.getElementById('input-binding-value').placeholder = skill.bindingType ?
    (skill.bindingType === 'category' ? 'è¾“å…¥é—®é¢˜åˆ†ç±» IDï¼Œå¦‚ incident_db_001' : 'è¾“å…¥å‘Šè­¦è§„åˆ™ IDï¼Œå¦‚ alert_rule_001') :
    'è¯·å…ˆé€‰æ‹©ç»‘å®šç±»å‹';
  document.getElementById('binding-hint').textContent = skill.bindingType ?
    (skill.bindingType === 'category' ? 'è¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„é—®é¢˜åˆ†ç±»è·¯ç”±' : 'è¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦è§„åˆ™çš„åŒ¹é…') :
    'é€‰æ‹©ç»‘å®šç±»å‹åï¼Œè¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„è·¯ç”±è§„åˆ™';
  document.getElementById('input-mcp').value = skill.mcpServers || '';
  document.getElementById('input-prompt').value = skill.prompt || '';
  document.getElementById('btn-sync-skill').disabled = false;
  document.getElementById('btn-test-mcp').disabled = !(skill.mcpServers && skill.mcpServers.length > 10);
  document.getElementById('mcp-test-status').style.display = 'none';

  document.getElementById('sync-status').style.display = 'block';
  document.getElementById('sync-status').innerHTML = `
    <div class="sync-status-bar success">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      <span>å·²åŒæ­¥ Â· ${skill.version}</span>
    </div>`;

  if (skill.status === 'update-available') {
    document.getElementById('update-banner').style.display = 'block';
  } else {
    document.getElementById('update-banner').style.display = 'none';
  }

  document.getElementById('skill-name-group').style.display = 'block';
  const skillNameSelect = document.getElementById('select-skill-name');
  skillNameSelect.innerHTML = `<option value="${skill.skillName}" selected>${skill.skillName}</option>`;
  skillNameSelect.disabled = true;
  selectedSkillName = skill.skillName;
  document.getElementById('skill-name-hint').textContent = 'ç¼–è¾‘æ¨¡å¼ä¸‹ä¸å¯ä¿®æ”¹ Skill åç§°';

  document.getElementById('preview-version').style.display = 'inline-flex';
  document.getElementById('preview-version').textContent = skill.version;
  renderMarkdown(skill.skillMd);

  showPage('page-skill-form');
}

function goBackToList() {
  showPage('page-skills-list');
  editingId = null;
}

// ===== Form Logic =====
function onUrlInput(value) {
  const btn = document.getElementById('btn-sync-skill');
  const isValid = value.startsWith('https://') && value.length > 20;
  btn.disabled = !isValid;
}

function onBindingTypeChange(value) {
  const input = document.getElementById('input-binding-value');
  const hint = document.getElementById('binding-hint');

  if (value === 'category') {
    input.disabled = false;
    input.placeholder = 'è¾“å…¥é—®é¢˜åˆ†ç±» IDï¼Œå¦‚ incident_db_001';
    hint.textContent = 'è¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„é—®é¢˜åˆ†ç±»è·¯ç”±';
  } else if (value === 'rule') {
    input.disabled = false;
    input.placeholder = 'è¾“å…¥å‘Šè­¦è§„åˆ™ IDï¼Œå¦‚ alert_rule_001';
    hint.textContent = 'è¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦è§„åˆ™çš„åŒ¹é…';
  } else {
    input.disabled = true;
    input.value = '';
    input.placeholder = 'è¯·å…ˆé€‰æ‹©ç»‘å®šç±»å‹';
    hint.textContent = 'é€‰æ‹©ç»‘å®šç±»å‹åï¼Œè¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„è·¯ç”±è§„åˆ™';
  }
}

function onBindingValueInput(value) {
  // Validation logic if needed
}

function onSkillNameChange(value) {
  selectedSkillName = value;
  if (value && detectedSkillNames.length > 0) {
    showToast(`å·²é€‰æ‹© Skill: ${value}`, 'info');
  }
}

function onMcpInput(value) {
  const btn = document.getElementById('btn-test-mcp');
  const isValid = value.startsWith('https://') && value.length > 10;
  btn.disabled = !isValid;
  document.getElementById('mcp-test-status').style.display = 'none';
}

function testMcpServer() {
  const btn = document.getElementById('btn-test-mcp');
  const statusDiv = document.getElementById('mcp-test-status');
  const mcpValue = document.getElementById('input-mcp').value;
  const servers = mcpValue.split(',').map(s => s.trim()).filter(s => s);

  btn.disabled = true;
  statusDiv.style.display = 'block';
  statusDiv.innerHTML = `<div class="sync-status-bar loading"><svg class="sync-spinner spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg><span>æ­£åœ¨æµ‹è¯• ${servers.length} ä¸ª MCP Server çš„è¿æ¥æƒé™...</span></div>`;

  setTimeout(() => {
    btn.disabled = false;
    const results = servers.map(s => {
      const shortName = s.split('/').filter(p => p).pop() || s;
      return '<span style="display:inline-flex;align-items:center;gap:4px;margin-right:10px"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:12px;height:12px"><polyline points="20 6 9 17 4 12"/></svg>' + shortName + '</span>';
    }).join('');
    statusDiv.innerHTML = `<div class="sync-status-bar success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>æƒé™éªŒè¯é€šè¿‡ï¼š${results}</span></div>`;
    showToast('MCP Server æƒé™éªŒè¯é€šè¿‡', 'success');
  }, 1200);
}

function syncSkill() {
  const btn = document.getElementById('btn-sync-skill');
  const statusDiv = document.getElementById('sync-status');
  const currentSkillName = selectedSkillName;

  btn.classList.add('syncing');
  btn.disabled = true;
  statusDiv.style.display = 'block';
  statusDiv.innerHTML = `<div class="sync-status-bar loading"><svg class="sync-spinner spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg><span>æ­£åœ¨ä» Skills å¸‚åœºåŒæ­¥...</span></div>`;

  setTimeout(() => {
    btn.classList.remove('syncing');
    btn.disabled = false;

    detectedSkillNames = ['db-diagnosis', 'db-slow-query', 'db-connection-pool'];
    const isInEditMode = editingId !== null;
    if (!isInEditMode) {
      selectedSkillName = '';
    }

    const skillNameSelect = document.getElementById('select-skill-name');
    skillNameSelect.innerHTML = '<option value="">è¯·é€‰æ‹© Skill</option>';
    detectedSkillNames.forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      if (isInEditMode && name === currentSkillName) {
        option.selected = true;
      }
      skillNameSelect.appendChild(option);
    });

    document.getElementById('skill-name-group').style.display = 'block';

    if (isInEditMode) {
      skillNameSelect.disabled = true;
      document.getElementById('skill-name-hint').textContent = 'ç¼–è¾‘æ¨¡å¼ä¸‹ä¸å¯ä¿®æ”¹ Skill åç§°';
    } else {
      skillNameSelect.disabled = false;
      document.getElementById('skill-name-hint').textContent = 'ä»ä»“åº“ä¸­è¯†åˆ«åˆ°çš„ Skillï¼Œè¯·é€‰æ‹©éœ€è¦æ¥å…¥çš„ Skill';
    }

    statusDiv.innerHTML = `<div class="sync-status-bar success"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>åŒæ­¥æˆåŠŸ Â· æ£€æµ‹åˆ° ${detectedSkillNames.length} ä¸ª Skill</span></div>`;

    document.getElementById('preview-version').style.display = 'inline-flex';
    document.getElementById('preview-version').textContent = 'v2.0.0';
    renderMarkdown(MOCK_SKILL_MD);
    showToast(`Skill åŒæ­¥æˆåŠŸï¼Œæ£€æµ‹åˆ° ${detectedSkillNames.length} ä¸ª Skill`, 'success');
  }, 1500);
}

function syncLatest() {
  const banner = document.getElementById('update-banner');
  const btn = banner.querySelector('.btn-sync');
  const origText = btn.innerHTML;

  btn.classList.add('syncing');
  btn.innerHTML = `<svg class="sync-spinner spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg> åŒæ­¥ä¸­...`;

  setTimeout(() => {
    banner.style.display = 'none';
    document.getElementById('preview-version').textContent = 'v2.1.0';

    document.getElementById('sync-status').innerHTML = `
      <div class="sync-status-bar success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span>å·²åŒæ­¥æœ€æ–°ç‰ˆæœ¬ Â· v2.1.0</span>
      </div>`;

    if (editingId) {
      const skill = skills.find(s => s.id === editingId);
      if (skill) {
        skill.version = 'v2.1.0';
        skill.status = 'normal';
      }
    }

    showToast('å·²åŒæ­¥è‡³æœ€æ–°ç‰ˆæœ¬ v2.1.0', 'success');
  }, 1800);
}

function submitForm() {
  const url = document.getElementById('input-url').value;
  const bindingType = document.getElementById('select-binding-type').value;
  const bindingValue = document.getElementById('input-binding-value').value;
  const mcp = document.getElementById('input-mcp').value;
  const prompt = document.getElementById('input-prompt').value;

  if (!url || !bindingType || !bindingValue || !mcp) {
    showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆURLã€ç»‘å®šç±»å‹ã€ç»‘å®šå€¼ã€MCP Serverï¼‰', 'info');
    return;
  }

  if (!editingId && detectedSkillNames.length === 0) {
    showToast('è¯·å…ˆç‚¹å‡»ã€ŒåŒæ­¥ã€æŒ‰é’®ä» Skills å¸‚åœºè·å– Skill ä¿¡æ¯', 'info');
    return;
  }

  if (!editingId && detectedSkillNames.length > 0 && !selectedSkillName) {
    showToast('è¯·é€‰æ‹©è¦æ¥å…¥çš„ Skill', 'info');
    return;
  }

  if (editingId) {
    const skill = skills.find(s => s.id === editingId);
    if (skill) {
      skill.url = url;
      skill.bindingType = bindingType;
      skill.bindingValue = bindingValue;
      skill.mcpServers = mcp;
      skill.prompt = prompt;
      if (selectedSkillName) {
        skill.skillName = selectedSkillName;
      }
    }
    showToast('Skill å·²æ›´æ–°', 'success');
  } else {
    const nameMatch = MOCK_SKILL_MD.match(/^# (.+)/m);
    skills.push({
      id: nextId++,
      name: nameMatch ? nameMatch[1] : 'æ–° Skill',
      icon: 'âœ¨',
      bindingType: bindingType,
      bindingValue: bindingValue,
      skillName: selectedSkillName || 'unknown',
      createdAt: '2026-02-27',
      createdBy: 'å½“å‰ç”¨æˆ·',
      status: 'normal',
      url: url,
      version: 'v2.0.0',
      prompt: prompt || `è¯·ä½¿ç”¨#{skillName}è¿›è¡Œå‘Šè­¦è¯Šæ–­ï¼š#{ticketString}`,
      mcpServers: mcp,
      skillMd: MOCK_SKILL_MD
    });
    showToast('Skill åˆ›å»ºæˆåŠŸ', 'success');
  }

  detectedSkillNames = [];
  selectedSkillName = '';

  renderSkillsTable();
  goBackToList();
}

// ===== Markdown Renderer =====
function renderMarkdown(md) {
  let html = md
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/^---$/gm, '<hr>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/`([^`]+)`/g, '<code>$1</code>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');

  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');

  html = html.split('\n').map(line => {
    const trimmed = line.trim();
    if (!trimmed) return '';
    if (trimmed.startsWith('<h') || trimmed.startsWith('<ul') || trimmed.startsWith('<li') ||
        trimmed.startsWith('<pre') || trimmed.startsWith('<hr') || trimmed.startsWith('</')) return line;
    return `<p>${line}</p>`;
  }).join('\n');

  document.getElementById('preview-body').innerHTML = `<div class="md-preview">${html}</div>`;
}

function insertVar(varName) {
  const textarea = document.getElementById('input-prompt');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const text = textarea.value;
  textarea.value = text.substring(0, start) + varName + text.substring(end);
  textarea.focus();
  textarea.selectionStart = textarea.selectionEnd = start + varName.length;
}

// ===== Delete Modal =====
function showDeleteModal(id) {
  deleteTargetId = id;
  document.getElementById('delete-modal').classList.add('active');
}

function closeDeleteModal() {
  deleteTargetId = null;
  document.getElementById('delete-modal').classList.remove('active');
}

function confirmDelete() {
  if (deleteTargetId) {
    skills = skills.filter(s => s.id !== deleteTargetId);
    renderSkillsTable();
    showToast('Skill å·²åˆ é™¤', 'info');
  }
  closeDeleteModal();
}

// ===== Toast =====
function showToast(message, type) {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      ${type === 'success'
        ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>'
        : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
    </svg>
    ${message}`;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ===== Init =====
renderAlertsTable();
renderCategoriesTable();
renderSkillsTable();
</script>
</body>
</html>
