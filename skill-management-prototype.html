<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‡ªå®šä¹‰ Skill æ¥å…¥ç®¡ç†</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f7f8fa;
    --bg-tertiary: #f0f1f3;
    --bg-elevated: #f5f6f8;
    --bg-hover: #edeef1;
    --border-subtle: rgba(0,0,0,0.06);
    --border-default: rgba(0,0,0,0.12);
    --border-focus: rgba(59,130,246,0.5);
    --text-primary: #1a1a2e;
    --text-secondary: #6b7280;
    --text-tertiary: #9ca3af;
    --accent-blue: #3b82f6;
    --accent-blue-dim: rgba(59,130,246,0.08);
    --accent-blue-glow: rgba(59,130,246,0.2);
    --accent-green: #10b981;
    --accent-green-dim: rgba(16,185,129,0.08);
    --accent-amber: #d97706;
    --accent-amber-dim: rgba(217,119,6,0.08);
    --accent-red: #ef4444;
    --accent-red-dim: rgba(239,68,68,0.06);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
    --font-sans: 'DM Sans', -apple-system, sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    --transition-fast: 120ms ease;
    --transition-default: 200ms ease;
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font-sans);
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
  }

  /* ===== Layout Shell ===== */
  .app-shell {
    display: flex;
    min-height: 100vh;
  }

  .sidebar {
    width: 220px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-subtle);
    padding: 20px 0;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
  }

  .sidebar-brand {
    padding: 0 20px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sidebar-brand-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--accent-blue), #8b5cf6);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sidebar-brand-icon svg { width: 16px; height: 16px; }

  .sidebar-brand-name {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--text-primary);
  }

  .sidebar-section {
    padding: 0 12px;
    margin-bottom: 24px;
  }

  .sidebar-section-label {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 0 8px;
    margin-bottom: 6px;
  }

  .sidebar-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 7px 8px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
  }

  .sidebar-item:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .sidebar-item.active {
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
  }

  .sidebar-item svg { width: 16px; height: 16px; opacity: 0.7; flex-shrink: 0; }
  .sidebar-item.active svg { opacity: 1; }

  .sidebar-spacer { flex: 1; }

  /* ===== Main Content ===== */
  .main-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
  }

  /* ===== Page: List ===== */
  .page { display: none; flex-direction: column; height: 100vh; }
  .page.active { display: flex; }

  .page-header {
    padding: 24px 32px 0;
    flex-shrink: 0;
  }

  .page-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .page-title {
    font-size: 22px;
    font-weight: 600;
    letter-spacing: -0.03em;
    color: var(--text-primary);
  }

  .page-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  /* ===== Buttons ===== */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: var(--radius-sm);
    font-family: var(--font-sans);
    font-size: 13px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
  }

  .btn svg { width: 15px; height: 15px; }

  .btn-primary {
    background: var(--accent-blue);
    color: #fff;
    box-shadow: 0 1px 3px rgba(91,154,255,0.3);
  }
  .btn-primary:hover {
    background: #6da6ff;
    box-shadow: 0 2px 8px rgba(91,154,255,0.4);
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: #fff;
    color: var(--text-secondary);
    border: 1px solid var(--border-default);
  }
  .btn-secondary:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: rgba(0,0,0,0.2);
  }

  .btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    padding: 5px 8px;
  }
  .btn-ghost:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .btn-sync {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    border: 1px solid rgba(217,119,6,0.2);
  }
  .btn-sync:hover {
    background: rgba(217,119,6,0.12);
    border-color: rgba(217,119,6,0.35);
  }

  .btn-danger {
    background: var(--accent-red-dim);
    color: var(--accent-red);
  }
  .btn-danger:hover {
    background: rgba(239,68,68,0.12);
  }

  /* ===== Table ===== */
  .table-container {
    flex: 1;
    overflow-y: auto;
    padding: 0 32px 32px;
  }

  .table {
    width: 100%;
    border-collapse: collapse;
  }

  .table th {
    text-align: left;
    padding: 10px 16px;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 1px solid var(--border-subtle);
    position: sticky;
    top: 0;
    background: var(--bg-primary);
    z-index: 1;
  }

  .table td {
    padding: 14px 16px;
    font-size: 13px;
    border-bottom: 1px solid var(--border-subtle);
    vertical-align: middle;
  }

  .table tbody tr {
    transition: background var(--transition-fast);
  }
  .table tbody tr:hover {
    background: var(--bg-tertiary);
  }

  .skill-name {
    font-weight: 500;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .skill-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .category-tag {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 100px;
    font-size: 12px;
    font-family: var(--font-mono);
    font-weight: 400;
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border-subtle);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 500;
  }

  .status-badge.normal {
    background: var(--accent-green-dim);
    color: var(--accent-green);
  }

  .status-badge.update-available {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .status-badge.update-available:hover {
    background: rgba(217,119,6,0.12);
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    flex-shrink: 0;
  }

  .status-badge.update-available .status-dot {
    animation: pulse-amber 2s ease-in-out infinite;
  }

  @keyframes pulse-amber {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .time-text {
    color: var(--text-tertiary);
    font-size: 13px;
  }

  .actions-cell {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* ===== Empty State ===== */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 32px;
    text-align: center;
  }

  .empty-state-icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-lg);
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
  }

  .empty-state-icon svg { width: 28px; height: 28px; color: var(--text-tertiary); }

  .empty-state-title {
    font-size: 15px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 6px;
  }

  .empty-state-desc {
    font-size: 13px;
    color: var(--text-tertiary);
    margin-bottom: 20px;
    max-width: 340px;
    line-height: 1.5;
  }

  /* ===== Form Page ===== */
  .form-page-header {
    padding: 16px 32px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    background: var(--bg-secondary);
  }

  .form-page-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .back-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .back-btn svg { width: 18px; height: 18px; }

  .form-page-title {
    font-size: 15px;
    font-weight: 600;
    letter-spacing: -0.02em;
  }

  .form-page-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .form-layout {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 0;
  }

  /* ===== Form Panel ===== */
  .form-panel {
    padding: 28px 32px;
    overflow-y: auto;
    border-right: 1px solid var(--border-subtle);
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 8px;
    letter-spacing: 0.01em;
  }

  .form-label .required {
    color: var(--accent-red);
    margin-left: 2px;
  }

  .form-input {
    width: 100%;
    padding: 9px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-default);
    background: #ffffff;
    color: var(--text-primary);
    font-family: var(--font-sans);
    font-size: 13px;
    transition: all var(--transition-fast);
    outline: none;
  }

  .form-input::placeholder {
    color: var(--text-tertiary);
  }

  .form-input:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--accent-blue-dim);
    background: #ffffff;
  }

  .form-input-row {
    display: flex;
    gap: 8px;
  }

  .form-input-row .form-input { flex: 1; }

  .form-textarea {
    min-height: 140px;
    resize: vertical;
    line-height: 1.6;
    font-family: var(--font-mono);
    font-size: 12.5px;
  }

  .form-hint {
    margin-top: 6px;
    font-size: 12px;
    color: var(--text-tertiary);
    line-height: 1.5;
  }

  .form-hint code {
    font-family: var(--font-mono);
    font-size: 11.5px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--accent-blue);
  }

  .form-divider {
    height: 1px;
    background: var(--border-subtle);
    margin: 28px 0;
  }

  .sync-status-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    margin-top: 10px;
  }

  .sync-status-bar.success {
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border: 1px solid rgba(16,185,129,0.15);
  }

  .sync-status-bar.warning {
    background: var(--accent-amber-dim);
    color: var(--accent-amber);
    border: 1px solid rgba(217,119,6,0.15);
  }

  .sync-status-bar svg { width: 14px; height: 14px; flex-shrink: 0; }
  .sync-status-bar span { flex: 1; }

  /* ===== Preview Panel ===== */
  .preview-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-secondary);
    overflow: hidden;
  }

  .preview-header {
    padding: 14px 24px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }

  .preview-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .preview-header-left svg { width: 14px; height: 14px; }

  .preview-version {
    font-family: var(--font-mono);
    font-size: 11px;
    padding: 2px 7px;
    border-radius: 100px;
    background: var(--bg-elevated);
    color: var(--text-tertiary);
    border: 1px solid var(--border-subtle);
  }

  .preview-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
  }

  .preview-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    color: var(--text-tertiary);
    font-size: 13px;
    gap: 12px;
  }

  .preview-empty svg { width: 40px; height: 40px; opacity: 0.3; }

  /* Markdown preview styles */
  .md-preview {
    font-size: 13.5px;
    line-height: 1.7;
    color: var(--text-secondary);
    animation: fadeInUp 350ms ease;
  }

  .md-preview h1 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    letter-spacing: -0.03em;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-subtle);
  }

  .md-preview h2 {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 24px;
    margin-bottom: 8px;
    letter-spacing: -0.01em;
  }

  .md-preview h3 {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 18px;
    margin-bottom: 6px;
  }

  .md-preview p { margin-bottom: 12px; }

  .md-preview code {
    font-family: var(--font-mono);
    font-size: 12px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--accent-blue);
  }

  .md-preview pre {
    background: var(--bg-primary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 14px 16px;
    margin: 12px 0;
    overflow-x: auto;
  }

  .md-preview pre code {
    background: none;
    border: none;
    padding: 0;
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .md-preview ul, .md-preview ol {
    margin: 8px 0 12px 20px;
  }

  .md-preview li {
    margin-bottom: 4px;
  }

  .md-preview strong {
    color: var(--text-primary);
    font-weight: 600;
  }

  .md-preview hr {
    border: none;
    height: 1px;
    background: var(--border-subtle);
    margin: 20px 0;
  }

  /* ===== Animations ===== */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-8px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .page.active { animation: fadeIn 250ms ease; }

  .table tbody tr {
    animation: fadeInUp 300ms ease backwards;
  }
  .table tbody tr:nth-child(1) { animation-delay: 40ms; }
  .table tbody tr:nth-child(2) { animation-delay: 80ms; }
  .table tbody tr:nth-child(3) { animation-delay: 120ms; }
  .table tbody tr:nth-child(4) { animation-delay: 160ms; }
  .table tbody tr:nth-child(5) { animation-delay: 200ms; }

  /* ===== Sync animation ===== */
  .syncing .sync-spinner {
    animation: spin 800ms linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* ===== Toast ===== */
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toast {
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: toastIn 300ms ease, toastOut 300ms ease 2.5s forwards;
    box-shadow: var(--shadow-lg);
  }

  .toast.success {
    background: #ecfdf5;
    color: var(--accent-green);
    border: 1px solid rgba(16,185,129,0.2);
  }

  .toast.info {
    background: #eff6ff;
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.2);
  }

  .toast svg { width: 16px; height: 16px; }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(12px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-8px); }
  }

  /* ===== Delete Confirm Modal ===== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(4px);
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
    animation: fadeIn 150ms ease;
  }

  .modal-overlay.active {
    display: flex;
  }

  .modal {
    background: #ffffff;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-lg);
    padding: 24px;
    max-width: 400px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    animation: fadeInUp 200ms ease;
  }

  .modal-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .modal-desc {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 20px;
  }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
  }

  /* ===== Scrollbar ===== */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }

  /* ===== Variable tag ===== */
  .var-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 8px;
  }

  .var-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: var(--radius-sm);
    font-family: var(--font-mono);
    font-size: 11.5px;
    background: var(--accent-blue-dim);
    color: var(--accent-blue);
    border: 1px solid rgba(59,130,246,0.15);
    cursor: pointer;
    transition: all var(--transition-fast);
    user-select: none;
  }

  .var-tag:hover {
    background: rgba(59,130,246,0.12);
    border-color: rgba(59,130,246,0.3);
  }

  .var-tag svg { width: 12px; height: 12px; }
</style>
</head>
<body>

<div class="app-shell">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-brand">
      <div class="sidebar-brand-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      </div>
      <span class="sidebar-brand-name">OpsCenter</span>
    </div>

    <div class="sidebar-section">
      <a class="sidebar-item active" href="#">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        è‡ªå®šä¹‰ Skills
      </a>
    </div>

    <div class="sidebar-spacer"></div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">

    <!-- ========== LIST PAGE ========== -->
    <div class="page active" id="page-list">
      <div class="page-header">
        <div class="page-header-row">
          <div>
            <div class="page-title">è‡ªå®šä¹‰ Skills</div>
            <div class="page-subtitle">ä» Skills å¸‚åœºæ¥å…¥å¹¶ç®¡ç†å‘Šè­¦å¤„ç†èƒ½åŠ›</div>
          </div>
          <button class="btn btn-primary" onclick="showCreateForm()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            åˆ›å»º Skill
          </button>
        </div>
      </div>

      <div class="table-container" id="table-container">
        <!-- Table will be rendered by JS -->
      </div>
    </div>

    <!-- ========== FORM PAGE ========== -->
    <div class="page" id="page-form">
      <div class="form-page-header">
        <div class="form-page-header-left">
          <button class="back-btn" onclick="goBackToList()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <span class="form-page-title" id="form-page-title">åˆ›å»º Skill</span>
        </div>
        <div class="form-page-actions">
          <button class="btn btn-secondary" onclick="goBackToList()">å–æ¶ˆ</button>
          <button class="btn btn-primary" id="form-submit-btn" onclick="submitForm()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
            åˆ›å»º
          </button>
        </div>
      </div>

      <div class="form-layout">
        <!-- Left: Form -->
        <div class="form-panel">
          <div class="form-group">
            <label class="form-label">Skills å¸‚åœºé“¾æ¥ <span class="required">*</span></label>
            <div class="form-input-row">
              <input type="url" class="form-input" id="input-url" placeholder="https://skills-market.example.com/skill/xxx" oninput="onUrlInput(this.value)">
              <button class="btn btn-secondary" id="btn-sync-skill" onclick="syncSkill()" disabled>
                <svg class="sync-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                åŒæ­¥
              </button>
            </div>
            <div id="sync-status" style="display:none"></div>
          </div>

          <div id="update-banner" style="display:none">
            <div class="sync-status-bar warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              <span>æ£€æµ‹åˆ° Skills å¸‚åœºæœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼ˆè¿œç¨‹ v2.1.0 â†’ æœ¬åœ° v2.0.0ï¼‰</span>
              <button class="btn btn-sync" onclick="syncLatest()" style="flex-shrink:0">
                <svg class="sync-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:13px;height:13px"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                åŒæ­¥æœ€æ–°ç‰ˆæœ¬
              </button>
            </div>
          </div>

          <div class="form-divider"></div>

          <div class="form-group">
            <label class="form-label">é—®é¢˜åˆ†ç±» ID <span class="required">*</span></label>
            <input type="text" class="form-input" id="input-category" placeholder="è¾“å…¥é—®é¢˜åˆ†ç±» IDï¼Œå¦‚ incident_db_001">
            <div class="form-hint">è¯¥ ID å°†ç”¨äºå…³è”å‘Šè­¦å·¥å•çš„é—®é¢˜åˆ†ç±»è·¯ç”±</div>
          </div>

          <div class="form-group">
            <label class="form-label">MCP Server <span class="required">*</span></label>
            <div class="form-input-row">
              <input type="text" class="form-input" id="input-mcp" placeholder="https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp" oninput="onMcpInput(this.value)">
              <button class="btn btn-secondary" id="btn-test-mcp" onclick="testMcpServer()" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:15px;height:15px"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                æµ‹è¯•æƒé™
              </button>
            </div>
            <div class="form-hint">å¦‚éœ€é…ç½®å¤šä¸ª MCP Serverï¼Œè¯·ä»¥è‹±æ–‡é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š<code>https://host1/mcp,https://host2/mcp</code></div>
            <div id="mcp-test-status" style="display:none"></div>
          </div>

          <div class="form-group">
            <label class="form-label">è°ƒç”¨ Prompt <span class="required">*</span></label>
            <textarea class="form-input form-textarea" id="input-prompt" placeholder="è¯·æ ¹æ®ä»¥ä¸‹å‘Šè­¦ä¿¡æ¯è¿›è¡Œåˆ†æå’Œå¤„ç½®å»ºè®®ï¼š&#10;&#10;#{ticketString}&#10;&#10;è¯·è¾“å‡ºï¼š&#10;1. å‘Šè­¦æ ¹å› åˆ†æ&#10;2. å¤„ç½®å»ºè®®&#10;3. ç›¸ä¼¼å†å²æ¡ˆä¾‹"></textarea>
            <div class="form-hint">
              Prompt ä¸­å¯ä½¿ç”¨å˜é‡å ä½ç¬¦ï¼Œç³»ç»Ÿä¼šåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨æ›¿æ¢ä¸ºå®é™…å€¼ã€‚
            </div>
            <div class="var-tags">
              <span class="var-tag" onclick="insertVar('#{ticketString}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{ticketString}
                <span style="font-family:var(--font-sans);opacity:0.6;font-size:10px;margin-left:2px">å‘Šè­¦æºä¿¡æ¯</span>
              </span>
              <span class="var-tag" onclick="insertVar('#{alertLevel}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{alertLevel}
                <span style="font-family:var(--font-sans);opacity:0.6;font-size:10px;margin-left:2px">å‘Šè­¦ç­‰çº§</span>
              </span>
              <span class="var-tag" onclick="insertVar('#{serviceName}')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                #{serviceName}
                <span style="font-family:var(--font-sans);opacity:0.6;font-size:10px;margin-left:2px">æœåŠ¡åç§°</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Right: Preview -->
        <div class="preview-panel">
          <div class="preview-header">
            <div class="preview-header-left">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              Skill é¢„è§ˆ
            </div>
            <span class="preview-version" id="preview-version" style="display:none">v2.0.0</span>
          </div>
          <div class="preview-body" id="preview-body">
            <div class="preview-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <span>è¾“å…¥ Skills å¸‚åœºé“¾æ¥å¹¶åŒæ­¥å<br>æ­¤å¤„å°†é¢„è§ˆ skill.md å†…å®¹</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Delete Modal -->
<div class="modal-overlay" id="delete-modal">
  <div class="modal">
    <div class="modal-title">ç¡®è®¤åˆ é™¤</div>
    <div class="modal-desc">åˆ é™¤åè¯¥ Skill å°†ä¸å†å‚ä¸å‘Šè­¦å¤„ç†æµç¨‹ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeDeleteModal()">å–æ¶ˆ</button>
      <button class="btn btn-danger" onclick="confirmDelete()">åˆ é™¤</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ===== Mock Data =====
const MOCK_SKILL_MD = `# æ•°æ®åº“å‘Šè­¦è¯Šæ–­ Skill

æ™ºèƒ½åˆ†ææ•°æ®åº“ç›¸å…³å‘Šè­¦ï¼Œæä¾›æ ¹å› åˆ†æå’Œå¤„ç½®å»ºè®®ã€‚

## æ¦‚è¿°

æœ¬ Skill ä¸“æ³¨äºæ•°æ®åº“ï¼ˆMySQLã€PostgreSQLã€MongoDBï¼‰ç›¸å…³å‘Šè­¦çš„è‡ªåŠ¨åŒ–è¯Šæ–­ï¼Œè¦†ç›–è¿æ¥æ± è€—å°½ã€æ…¢æŸ¥è¯¢å †ç§¯ã€ä¸»ä»å»¶è¿Ÿã€ç£ç›˜ç©ºé—´ä¸è¶³ç­‰å¸¸è§åœºæ™¯ã€‚

## èƒ½åŠ›èŒƒå›´

- **è¿æ¥æ± åˆ†æ**ï¼šæ£€æµ‹è¿æ¥æ³„æ¼ã€å¹¶å‘å³°å€¼ã€é…ç½®ä¸å½“
- **æ…¢æŸ¥è¯¢è¯Šæ–­**ï¼šè¯†åˆ«å…¨è¡¨æ‰«æã€ç´¢å¼•ç¼ºå¤±ã€é”ç­‰å¾…
- **ä¸»ä»åŒæ­¥**ï¼šå»¶è¿Ÿè¶‹åŠ¿åˆ†æã€æ–­å¼€åŸå› å®šä½
- **èµ„æºé¢„è­¦**ï¼šç£ç›˜ / å†…å­˜ / CPU è¶‹åŠ¿é¢„æµ‹

## è¾“å…¥æ ¼å¼

\`\`\`json
{
  "alert_type": "db_connection_pool_exhausted",
  "service": "order-service",
  "metrics": { ... },
  "timestamp": "2026-02-27T10:30:00Z"
}
\`\`\`

## è¾“å‡ºæ ¼å¼

### æ ¹å› åˆ†æ
ç»™å‡ºæœ€å¯èƒ½çš„ 1-3 ä¸ªåŸå› åŠç½®ä¿¡åº¦è¯„ä¼°ã€‚

### å¤„ç½®å»ºè®®
æŒ‰ä¼˜å…ˆçº§æ’åºçš„å¤„ç½®æ­¥éª¤ï¼ŒåŒ…å«å…·ä½“å‘½ä»¤æˆ–æ“ä½œæŒ‡å¼•ã€‚

### å†å²å…³è”
è‡ªåŠ¨åŒ¹é…æœ€è¿‘ 30 å¤©å†…çš„ç›¸ä¼¼å‘Šè­¦åŠå…¶è§£å†³æ–¹æ¡ˆã€‚

---

**ç‰ˆæœ¬**: v2.0.0 | **ä½œè€…**: OpsTeam | **æ›´æ–°æ—¥æœŸ**: 2026-02-20`;

let skills = [
  {
    id: 1,
    name: 'æ•°æ®åº“å‘Šè­¦è¯Šæ–­',
    icon: 'ğŸ—„ï¸',
    categoryId: 'incident_db_001',
    createdAt: '2026-02-15',
    createdBy: 'å¼ æ˜',
    status: 'normal',
    url: 'https://skills-market.example.com/skill/db-diagnosis',
    version: 'v2.0.0',
    prompt: 'è¯·æ ¹æ®ä»¥ä¸‹å‘Šè­¦ä¿¡æ¯è¿›è¡Œæ•°æ®åº“å‘Šè­¦è¯Šæ–­ï¼š\n\n#{ticketString}\n\nè¯·è¾“å‡ºæ ¹å› åˆ†æå’Œå¤„ç½®å»ºè®®ã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp',
    skillMd: MOCK_SKILL_MD
  },
  {
    id: 2,
    name: 'K8s å®¹å™¨å¼‚å¸¸åˆ†æ',
    icon: 'âˆ',
    categoryId: 'incident_k8s_002',
    createdAt: '2026-02-18',
    createdBy: 'æä¼Ÿ',
    status: 'update-available',
    url: 'https://skills-market.example.com/skill/k8s-analysis',
    version: 'v1.3.0',
    prompt: 'ä»¥ä¸‹æ˜¯ K8s å®¹å™¨å‘Šè­¦ä¿¡æ¯ï¼š\n\n#{ticketString}\n\nè¯·åˆ†æ Pod å¼‚å¸¸åŸå› å¹¶ç»™å‡ºæ¢å¤æ–¹æ¡ˆã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/cnarch-sre-mcp-server-v2/mcp,https://pre-mcp.alibaba-inc.com/k8s-diag-server/mcp',
    skillMd: '# K8s å®¹å™¨å¼‚å¸¸åˆ†æ Skill\n\nè‡ªåŠ¨åˆ†æ Kubernetes ç¯å¢ƒä¸‹çš„å®¹å™¨å¼‚å¸¸...'
  },
  {
    id: 3,
    name: 'ç½‘ç»œè¿é€šæ€§è¯Šæ–­',
    icon: 'ğŸŒ',
    categoryId: 'incident_net_003',
    createdAt: '2026-02-22',
    createdBy: 'ç‹èŠ³',
    status: 'normal',
    url: 'https://skills-market.example.com/skill/network-diagnosis',
    version: 'v1.0.0',
    prompt: 'è¯·å¯¹ä»¥ä¸‹ç½‘ç»œå‘Šè­¦è¿›è¡Œåˆ†æï¼š\n\n#{ticketString}\n\nç¡®è®¤æ˜¯å¦ä¸ºç½‘ç»œæŠ–åŠ¨ã€ä¸¢åŒ…æˆ– DNS å¼‚å¸¸ã€‚',
    mcpServers: 'https://pre-mcp.alibaba-inc.com/network-diag-server/mcp',
    skillMd: '# ç½‘ç»œè¿é€šæ€§è¯Šæ–­ Skill\n\nç½‘ç»œå±‚å‘Šè­¦çš„è‡ªåŠ¨è¯Šæ–­ä¸æ’æŸ¥å»ºè®®...'
  }
];

let editingId = null;
let deleteTargetId = null;
let nextId = 4;

// ===== Render List =====
function renderList() {
  const container = document.getElementById('table-container');
  if (skills.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        </div>
        <div class="empty-state-title">è¿˜æ²¡æœ‰è‡ªå®šä¹‰ Skill</div>
        <div class="empty-state-desc">ä» Skills å¸‚åœºæ¥å…¥ Skill æ¥å¢å¼ºå‘Šè­¦å¤„ç†èƒ½åŠ›ï¼Œæ”¯æŒè‡ªå®šä¹‰è°ƒç”¨ Prompt å’Œé—®é¢˜åˆ†ç±»è·¯ç”±ã€‚</div>
        <button class="btn btn-primary" onclick="showCreateForm()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          åˆ›å»ºç¬¬ä¸€ä¸ª Skill
        </button>
      </div>`;
    return;
  }

  container.innerHTML = `
    <table class="table">
      <thead>
        <tr>
          <th>Skill åç§°</th>
          <th>é—®é¢˜åˆ†ç±»</th>
          <th>åˆ›å»ºäºº</th>
          <th>åˆ›å»ºæ—¶é—´</th>
          <th>çŠ¶æ€</th>
          <th style="width:120px">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        ${skills.map(s => `
          <tr>
            <td>
              <div class="skill-name">
                <div class="skill-icon">${s.icon}</div>
                ${s.name}
              </div>
            </td>
            <td><span class="category-tag">${s.categoryId}</span></td>
            <td><span style="font-size:13px;color:var(--text-secondary)">${s.createdBy || '-'}</span></td>
            <td><span class="time-text">${s.createdAt}</span></td>
            <td>
              ${s.status === 'normal'
                ? '<span class="status-badge normal"><span class="status-dot"></span>å·²åŒæ­¥</span>'
                : `<span class="status-badge update-available" onclick="editSkill(${s.id})"><span class="status-dot"></span>æœ‰æ›´æ–°</span>`
              }
            </td>
            <td>
              <div class="actions-cell">
                <button class="btn btn-ghost" onclick="editSkill(${s.id})" title="ç¼–è¾‘">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:15px;height:15px"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                  ç¼–è¾‘
                </button>
                <button class="btn btn-ghost" onclick="showDeleteModal(${s.id})" title="åˆ é™¤" style="color:var(--text-tertiary)">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:15px;height:15px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>`;
}

// ===== Navigation =====
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
}

function showCreateForm() {
  editingId = null;
  document.getElementById('form-page-title').textContent = 'åˆ›å»º Skill';
  document.getElementById('form-submit-btn').innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
    åˆ›å»º`;
  document.getElementById('input-url').value = '';
  document.getElementById('input-category').value = '';
  document.getElementById('input-mcp').value = '';
  document.getElementById('input-prompt').value = '';
  document.getElementById('sync-status').style.display = 'none';
  document.getElementById('update-banner').style.display = 'none';
  document.getElementById('preview-version').style.display = 'none';
  document.getElementById('mcp-test-status').style.display = 'none';
  document.getElementById('btn-test-mcp').disabled = true;
  document.getElementById('preview-body').innerHTML = `
    <div class="preview-empty">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span>è¾“å…¥ Skills å¸‚åœºé“¾æ¥å¹¶åŒæ­¥å<br>æ­¤å¤„å°†é¢„è§ˆ skill.md å†…å®¹</span>
    </div>`;
  document.getElementById('btn-sync-skill').disabled = true;
  showPage('page-form');
}

function editSkill(id) {
  const skill = skills.find(s => s.id === id);
  if (!skill) return;

  editingId = id;
  document.getElementById('form-page-title').textContent = 'ç¼–è¾‘ Skill';
  document.getElementById('form-submit-btn').innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
    ä¿å­˜`;
  document.getElementById('input-url').value = skill.url;
  document.getElementById('input-category').value = skill.categoryId;
  document.getElementById('input-mcp').value = skill.mcpServers || '';
  document.getElementById('input-prompt').value = skill.prompt;
  document.getElementById('btn-sync-skill').disabled = false;
  document.getElementById('btn-test-mcp').disabled = !(skill.mcpServers && skill.mcpServers.length > 10);
  document.getElementById('mcp-test-status').style.display = 'none';

  // Show synced status
  document.getElementById('sync-status').style.display = 'block';
  document.getElementById('sync-status').innerHTML = `
    <div class="sync-status-bar success">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      <span>å·²åŒæ­¥ Â· ${skill.version}</span>
    </div>`;

  // Show update banner for items with updates
  if (skill.status === 'update-available') {
    document.getElementById('update-banner').style.display = 'block';
  } else {
    document.getElementById('update-banner').style.display = 'none';
  }

  // Show preview
  document.getElementById('preview-version').style.display = 'inline-flex';
  document.getElementById('preview-version').textContent = skill.version;
  renderMarkdown(skill.skillMd);

  showPage('page-form');
}

function goBackToList() {
  showPage('page-list');
  editingId = null;
}

// ===== Form Logic =====
function onUrlInput(value) {
  const btn = document.getElementById('btn-sync-skill');
  const isValid = value.startsWith('https://') && value.length > 20;
  btn.disabled = !isValid;
}

function onMcpInput(value) {
  const btn = document.getElementById('btn-test-mcp');
  const isValid = value.startsWith('https://') && value.length > 10;
  btn.disabled = !isValid;
  document.getElementById('mcp-test-status').style.display = 'none';
}

function testMcpServer() {
  const btn = document.getElementById('btn-test-mcp');
  const statusDiv = document.getElementById('mcp-test-status');
  const mcpValue = document.getElementById('input-mcp').value;
  const servers = mcpValue.split(',').map(s => s.trim()).filter(s => s);

  btn.disabled = true;
  statusDiv.style.display = 'block';
  statusDiv.innerHTML = `
    <div class="sync-status-bar" style="background:var(--accent-blue-dim);color:var(--accent-blue);border:1px solid rgba(59,130,246,0.15)">
      <svg class="sync-spinner" style="animation:spin 800ms linear infinite" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      <span>æ­£åœ¨æµ‹è¯• ${servers.length} ä¸ª MCP Server çš„è¿æ¥æƒé™...</span>
    </div>`;

  setTimeout(() => {
    btn.disabled = false;
    const results = servers.map(s => {
      const shortName = s.split('/').filter(p => p).pop() || s;
      return '<span style="display:inline-flex;align-items:center;gap:4px;margin-right:10px"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" style="width:12px;height:12px"><polyline points="20 6 9 17 4 12"/></svg>' + shortName + '</span>';
    }).join('');
    statusDiv.innerHTML = `
      <div class="sync-status-bar success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span>æƒé™éªŒè¯é€šè¿‡ï¼š${results}</span>
      </div>`;
    showToast('MCP Server æƒé™éªŒè¯é€šè¿‡', 'success');
  }, 1200);
}

function syncSkill() {
  const btn = document.getElementById('btn-sync-skill');
  const statusDiv = document.getElementById('sync-status');
  
  btn.classList.add('syncing');
  btn.disabled = true;
  statusDiv.style.display = 'block';
  statusDiv.innerHTML = `
    <div class="sync-status-bar" style="background:var(--accent-blue-dim);color:var(--accent-blue);border:1px solid rgba(59,130,246,0.15)">
      <svg class="sync-spinner" style="animation:spin 800ms linear infinite" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      <span>æ­£åœ¨ä» Skills å¸‚åœºåŒæ­¥...</span>
    </div>`;

  setTimeout(() => {
    btn.classList.remove('syncing');
    btn.disabled = false;
    statusDiv.innerHTML = `
      <div class="sync-status-bar success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span>åŒæ­¥æˆåŠŸ Â· v2.0.0</span>
      </div>`;

    // Show preview
    document.getElementById('preview-version').style.display = 'inline-flex';
    document.getElementById('preview-version').textContent = 'v2.0.0';
    renderMarkdown(MOCK_SKILL_MD);
    showToast('Skill åŒæ­¥æˆåŠŸ', 'success');
  }, 1500);
}

function syncLatest() {
  const banner = document.getElementById('update-banner');
  const btn = banner.querySelector('.btn-sync');
  const origText = btn.innerHTML;
  
  btn.classList.add('syncing');
  btn.innerHTML = `<svg class="sync-spinner" style="animation:spin 800ms linear infinite" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="13" height="13"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg> åŒæ­¥ä¸­...`;

  setTimeout(() => {
    banner.style.display = 'none';
    document.getElementById('preview-version').textContent = 'v2.1.0';
    
    document.getElementById('sync-status').innerHTML = `
      <div class="sync-status-bar success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span>å·²åŒæ­¥æœ€æ–°ç‰ˆæœ¬ Â· v2.1.0</span>
      </div>`;

    if (editingId) {
      const skill = skills.find(s => s.id === editingId);
      if (skill) {
        skill.version = 'v2.1.0';
        skill.status = 'normal';
      }
    }

    showToast('å·²åŒæ­¥è‡³æœ€æ–°ç‰ˆæœ¬ v2.1.0', 'success');
  }, 1800);
}

function submitForm() {
  const url = document.getElementById('input-url').value;
  const category = document.getElementById('input-category').value;
  const mcp = document.getElementById('input-mcp').value;
  const prompt = document.getElementById('input-prompt').value;

  if (!url || !category || !prompt || !mcp) {
    showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'info');
    return;
  }

  if (editingId) {
    const skill = skills.find(s => s.id === editingId);
    if (skill) {
      skill.url = url;
      skill.categoryId = category;
      skill.mcpServers = mcp;
      skill.prompt = prompt;
    }
    showToast('Skill å·²æ›´æ–°', 'success');
  } else {
    const nameMatch = MOCK_SKILL_MD.match(/^# (.+)/m);
    skills.push({
      id: nextId++,
      name: nameMatch ? nameMatch[1] : 'æ–° Skill',
      icon: 'âœ¨',
      categoryId: category,
      createdAt: '2026-02-27',
      createdBy: 'å½“å‰ç”¨æˆ·',
      status: 'normal',
      url: url,
      version: 'v2.0.0',
      prompt: prompt,
      mcpServers: mcp,
      skillMd: MOCK_SKILL_MD
    });
    showToast('Skill åˆ›å»ºæˆåŠŸ', 'success');
  }

  renderList();
  goBackToList();
}

// ===== Markdown Renderer (simple) =====
function renderMarkdown(md) {
  let html = md
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/^---$/gm, '<hr>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/`([^`]+)`/g, '<code>$1</code>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');

  // Handle code blocks
  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');

  // Wrap remaining lines in <p> tags
  html = html.split('\n').map(line => {
    const trimmed = line.trim();
    if (!trimmed) return '';
    if (trimmed.startsWith('<h') || trimmed.startsWith('<ul') || trimmed.startsWith('<li') ||
        trimmed.startsWith('<pre') || trimmed.startsWith('<hr') || trimmed.startsWith('</')) return line;
    return `<p>${line}</p>`;
  }).join('\n');

  document.getElementById('preview-body').innerHTML = `<div class="md-preview">${html}</div>`;
}

// ===== Variable Insert =====
function insertVar(varName) {
  const textarea = document.getElementById('input-prompt');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const text = textarea.value;
  textarea.value = text.substring(0, start) + varName + text.substring(end);
  textarea.focus();
  textarea.selectionStart = textarea.selectionEnd = start + varName.length;
}

// ===== Delete =====
function showDeleteModal(id) {
  deleteTargetId = id;
  document.getElementById('delete-modal').classList.add('active');
}

function closeDeleteModal() {
  deleteTargetId = null;
  document.getElementById('delete-modal').classList.remove('active');
}

function confirmDelete() {
  if (deleteTargetId) {
    skills = skills.filter(s => s.id !== deleteTargetId);
    renderList();
    showToast('Skill å·²åˆ é™¤', 'info');
  }
  closeDeleteModal();
}

// ===== Toast =====
function showToast(message, type) {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
      ${type === 'success'
        ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>'
        : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
    </svg>
    ${message}`;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ===== Init =====
renderList();
</script>
</body>
</html>